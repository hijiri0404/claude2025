# OCI ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šãƒ†ã‚¹ãƒˆçµæœ

## ğŸ“… ä½œæˆæ—¥
2025-11-25

## ğŸ¯ ãƒ†ã‚¹ãƒˆç›®çš„
æä¾›ã•ã‚ŒãŸç§˜å¯†éµã‚’ä½¿ç”¨ã—ã¦OCIã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šãŒå¯èƒ½ã‹ã‚’æ¤œè¨¼

## âœ… ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼

### ç§˜å¯†éµã®æ¤œè¨¼
```
âœ… ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ: SHA256:zTWBdeBxmxbPfZausDyBEf2gGj+w6huySJiAwSf/uxM
âœ… éµã‚¿ã‚¤ãƒ—: RSA 2048ãƒ“ãƒƒãƒˆ
âœ… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: æ­£å¸¸ï¼ˆOpenSSHå½¢å¼ï¼‰
```

### ç¬¬1æ®µéšï¼šã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šã‚µãƒ¼ãƒãƒ¼ã¸ã®èªè¨¼
```
âœ… æ¥ç¶šæˆåŠŸ: instance-console.ap-tokyo-1.oci.oraclecloud.com:443
âœ… èªè¨¼æˆåŠŸ: Authenticated using "publickey"
âœ… ç§˜å¯†éµã®æ©Ÿèƒ½: æ­£å¸¸ã«å‹•ä½œ
âœ… ProxyCommand: æ­£å¸¸ã«æ©Ÿèƒ½
```

**é‡è¦**: **ç§˜å¯†éµã¯å®Œå…¨ã«æ­£å¸¸ã«æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ï¼**

### ç¬¬2æ®µéšï¼šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®æ¥ç¶š
```
âŒ ã‚¨ãƒ©ãƒ¼: Unable to negotiate with UNKNOWN port 65535
âŒ åŸå› : no matching host key type found. Their offer: ssh-rsa
```

## ğŸ” è©³ç´°åˆ†æ

### æ¥ç¶šãƒ—ãƒ­ã‚»ã‚¹ã®æµã‚Œ

```
ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ­ãƒ¼ã‚«ãƒ« â†’ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šã‚µãƒ¼ãƒãƒ¼
â”œâ”€ æ¥ç¶šé–‹å§‹: instance-console.ap-tokyo-1.oci.oraclecloud.com:443
â”œâ”€ éµäº¤æ›: curve25519-sha256@libssh.org
â”œâ”€ èªè¨¼è©¦è¡Œ: ç§˜å¯†éµ (SHA256:zTWBdeBxmxbPfZausDyBEf2gGj+w6huySJiAwSf/uxM)
â””â”€ çµæœ: âœ… Authenticated to instance-console.ap-tokyo-1.oci.oraclecloud.com

ã‚¹ãƒ†ãƒƒãƒ—2: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šã‚µãƒ¼ãƒãƒ¼ â†’ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
â”œâ”€ ãƒãƒ£ãƒãƒ«ç¢ºç«‹: stdio-forward
â”œâ”€ SSHãƒˆãƒ³ãƒãƒ«ä½œæˆ: ocid1.instance...
â”œâ”€ æ–°ã—ã„SSHæ¥ç¶šé–‹å§‹: InstanceConsoleSSHD
â”œâ”€ éµäº¤æ›è©¦è¡Œ: curve25519-sha256@libssh.org
â””â”€ ãƒ›ã‚¹ãƒˆéµæ¤œè¨¼: âŒ ssh-rsaã®ã¿æä¾›ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæ‹’å¦ï¼‰
```

### ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬åŸå› 

**ãƒ›ã‚¹ãƒˆéµã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä¸ä¸€è‡´**

#### ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆOCIã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
```
æä¾›ã—ã¦ã„ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ : ssh-rsa ã®ã¿
```

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆOpenSSH 9.6p1ï¼‰
```
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å—ã‘å…¥ã‚Œã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ :
  âœ… ssh-ed25519
  âœ… ecdsa-sha2-nistp256/384/521
  âœ… rsa-sha2-256/512
  âŒ ssh-rsaï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç„¡åŠ¹ï¼‰
```

**ãªãœssh-rsaãŒæ‹’å¦ã•ã‚Œã‚‹ã‹**:
- OpenSSH 8.8ä»¥é™ã€SHA-1ãƒ™ãƒ¼ã‚¹ã®RSAç½²åï¼ˆssh-rsaï¼‰ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç„¡åŠ¹åŒ–
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ï¼ˆSHA-1è¡çªæ”»æ’ƒï¼‰ã¸ã®å¯¾å¿œ
- ã‚ˆã‚Šå®‰å…¨ãªrsa-sha2-256/512ã¸ã®ç§»è¡Œã‚’æ¨å¥¨

## âœ… è§£æ±ºæ–¹æ³•

### æ–¹æ³•1: ssh-rsaã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æ˜ç¤ºçš„ã«è¨±å¯ï¼ˆæ¨å¥¨ï¼‰

```bash
ssh -i ~/.ssh/console_key \
    -o HostKeyAlgorithms=+ssh-rsa \
    -o PubkeyAcceptedAlgorithms=+ssh-rsa \
    -o ProxyCommand='ssh -i ~/.ssh/console_key -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa -W %h:%p -p 443 ocid1.instanceconsoleconnection.oc1.ap-tokyo-1.anxhiljrtc2ci5ac3xvxpnpdtxl3h4atdwcswf7w3a4kp5c2qkachqbtnzfq@instance-console.ap-tokyo-1.oci.oraclecloud.com' \
    ocid1.instance.oc1.ap-tokyo-1.anxhiljrtc2ci5acbpj3zsrtxhkng5qabyauegqk42rehbwqyu3xnrhpjt2a
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³èª¬æ˜**:
- `HostKeyAlgorithms=+ssh-rsa`: ãƒ›ã‚¹ãƒˆéµæ¤œè¨¼ã§ssh-rsaã‚’è¿½åŠ ã§è¨±å¯
- `PubkeyAcceptedAlgorithms=+ssh-rsa`: å…¬é–‹éµèªè¨¼ã§ssh-rsaã‚’è¿½åŠ ã§è¨±å¯
- `+`è¨˜å·: æ—¢å­˜ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒªã‚¹ãƒˆã«è¿½åŠ ï¼ˆç½®ãæ›ãˆã§ã¯ãªã„ï¼‰

### æ–¹æ³•2: SSHconfigè¨­å®šï¼ˆæ°¸ç¶šçš„ãªè¨­å®šï¼‰

`~/.ssh/config` ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```bash
# OCIã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šç”¨è¨­å®š
Host oci-console-*
    HostKeyAlgorithms +ssh-rsa
    PubkeyAcceptedAlgorithms +ssh-rsa
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null

Host oci-console-tokyo-instance1
    User ocid1.instance.oc1.ap-tokyo-1.anxhiljrtc2ci5acbpj3zsrtxhkng5qabyauegqk42rehbwqyu3xnrhpjt2a
    IdentityFile ~/.ssh/console_key
    ProxyCommand ssh -i ~/.ssh/console_key -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa -W %h:%p -p 443 ocid1.instanceconsoleconnection.oc1.ap-tokyo-1.anxhiljrtc2ci5ac3xvxpnpdtxl3h4atdwcswf7w3a4kp5c2qkachqbtnzfq@instance-console.ap-tokyo-1.oci.oraclecloud.com

# æ¥ç¶šæ–¹æ³•
ssh oci-console-tokyo-instance1
```

### æ–¹æ³•3: ãƒ¬ã‚¬ã‚·ãƒ¼SSHè¨­å®šã®ä¸€æ™‚çš„ä½¿ç”¨

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã‚’ä¸€æ™‚çš„ã«ä¸‹ã’ã‚‹ï¼ˆæ¨å¥¨ã—ãªã„ï¼‰
ssh -o HostKeyAlgorithms=ssh-rsa \
    -o PubkeyAcceptedAlgorithms=ssh-rsa \
    ...
```

âš ï¸ **æ³¨æ„**: `+`è¨˜å·ã‚’çœç•¥ã™ã‚‹ã¨ä»–ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ãŸã‚æ¨å¥¨ã—ã¾ã›ã‚“ã€‚

## ğŸ“Š æ¥ç¶šè©¦è¡Œã®ãƒ­ã‚°åˆ†æ

### æˆåŠŸã—ãŸéƒ¨åˆ†ï¼ˆç¬¬1æ®µéšï¼‰
```log
debug1: Connecting to instance-console.ap-tokyo-1.oci.oraclecloud.com [140.204.8.241] port 443.
debug1: Connection established.
debug1: identity file test_oci_key type 0
debug1: Authenticating to instance-console.ap-tokyo-1.oci.oraclecloud.com:443 as 'ocid1.instanceconsoleconnection...'
debug1: Offering public key: test_oci_key RSA SHA256:zTWBdeBxmxbPfZausDyBEf2gGj+w6huySJiAwSf/uxM explicit
debug1: Server accepts key: test_oci_key RSA SHA256:zTWBdeBxmxbPfZausDyBEf2gGj+w6huySJiAwSf/uxM explicit
debug1: Authentication succeeded (publickey).
âœ… Authenticated to instance-console.ap-tokyo-1.oci.oraclecloud.com using "publickey".
```

**è§£é‡ˆ**:
- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šã‚µãƒ¼ãƒãƒ¼ãŒç§˜å¯†éµã‚’å—ã‘å…¥ã‚ŒãŸ
- å…¬é–‹éµèªè¨¼ãŒæˆåŠŸ
- ProxyCommandãŒæ­£å¸¸ã«æ©Ÿèƒ½

### å¤±æ•—ã—ãŸéƒ¨åˆ†ï¼ˆç¬¬2æ®µéšï¼‰
```log
debug1: Remote protocol version 2.0, remote software version InstanceConsoleSSHD
debug2: host key algorithms: ssh-rsa
debug1: kex: host key algorithm: (no match)
Unable to negotiate with UNKNOWN port 65535: no matching host key type found. Their offer: ssh-rsa
```

**è§£é‡ˆ**:
- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®SSHãƒ‡ãƒ¼ãƒ¢ãƒ³ï¼ˆInstanceConsoleSSHDï¼‰ã«åˆ°é”
- ã‚µãƒ¼ãƒãƒ¼ã¯ssh-rsaã®ã¿ã‚’æä¾›
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ssh-rsaã‚’å—ã‘å…¥ã‚Œãªã„è¨­å®š
- ãƒ›ã‚¹ãƒˆéµã®ãƒã‚´ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤±æ•—

## ğŸ¯ çµè«–

### ç§˜å¯†éµã®çŠ¶æ…‹
```
âœ… ç§˜å¯†éµã¯å®Œå…¨ã«æ­£å¸¸
âœ… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯æ­£ã—ã„
âœ… ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šã‚µãƒ¼ãƒãƒ¼ã§èªè¨¼æˆåŠŸ
âœ… éµãƒšã‚¢ã®å¯¾å¿œé–¢ä¿‚ã¯æ­£å¸¸
```

### ã‚¨ãƒ©ãƒ¼ã®åŸå› 
```
âŒ ç§˜å¯†éµã®å•é¡Œã§ã¯ãªã„
âŒ èªè¨¼ã®å¤±æ•—ã§ã¯ãªã„
âœ… SSHè¨­å®šã®äº’æ›æ€§å•é¡Œ
âœ… ãƒ›ã‚¹ãƒˆéµã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä¸ä¸€è‡´
```

### å¿…è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
```
1. ã‚³ãƒãƒ³ãƒ‰ã« -o HostKeyAlgorithms=+ssh-rsa ã‚’è¿½åŠ 
2. ã‚³ãƒãƒ³ãƒ‰ã« -o PubkeyAcceptedAlgorithms=+ssh-rsa ã‚’è¿½åŠ 
3. ProxyCommandå†…ã«ã‚‚åŒã˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ssh-rsaã‚’è¨±å¯ã™ã‚‹ã“ã¨ã®ãƒªã‚¹ã‚¯
```
âš ï¸ SHA-1ãƒ™ãƒ¼ã‚¹ã®ç½²åï¼ˆç†è«–çš„ãªè„†å¼±æ€§ï¼‰
âš ï¸ ã‚ˆã‚Šå¼·å›ºãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¸ã®ç§»è¡ŒãŒæ¨å¥¨
```

### ãƒªã‚¹ã‚¯è»½æ¸›ç­–
```
âœ… + è¨˜å·ã§ä»–ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚‚æœ‰åŠ¹ã«ä¿ã¤
âœ… ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šå°‚ç”¨ã®è¨­å®šã«é™å®š
âœ… ~/.ssh/config ã§ãƒ›ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ¶é™
âœ… é€šå¸¸ã®SSHæ¥ç¶šã§ã¯ä½¿ç”¨ã—ãªã„
```

## ğŸ“š å‚è€ƒæƒ…å ±

### OpenSSH 8.8ã®å¤‰æ›´ç‚¹
- [OpenSSH 8.8ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ](https://www.openssh.com/txt/release-8.8)
- SHA-1ãƒ™ãƒ¼ã‚¹ã®RSAç½²åï¼ˆssh-rsaï¼‰ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç„¡åŠ¹åŒ–
- rsa-sha2-256/512ã¸ã®ç§»è¡Œã‚’æ¨å¥¨

### OCIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](https://docs.oracle.com/en-us/iaas/Content/Compute/References/serialconsole.htm#four)

## ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

### äºŒæ®µéšæ¥ç¶šã®ç†è§£
```
ç¬¬1æ®µéš: ã‚ãªãŸã®PC â†’ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šã‚µãƒ¼ãƒãƒ¼
  - ä½¿ç”¨éµ: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šä½œæˆæ™‚ã«ç™»éŒ²ã—ãŸéµ
  - èªè¨¼: âœ… æˆåŠŸ

ç¬¬2æ®µéš: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶šã‚µãƒ¼ãƒãƒ¼ â†’ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  - ä½¿ç”¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«: InstanceConsoleSSHD
  - ãƒ›ã‚¹ãƒˆéµ: ssh-rsaã®ã¿æä¾›
  - äº’æ›æ€§: âŒ ç¾ä»£ã®SSHã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ãƒŸã‚¹ãƒãƒƒãƒ
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ•™è¨“
```
1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ®µéšçš„ã«åˆ†æ
2. èªè¨¼å¤±æ•—ã¨è¨­å®šä¸ä¸€è‡´ã‚’åŒºåˆ¥
3. -vvv ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª
4. å„æ¥ç¶šæ®µéšã§ã®æˆåŠŸ/å¤±æ•—ã‚’ç‰¹å®š
```

## ğŸ“ ã¾ã¨ã‚

### ãƒ†ã‚¹ãƒˆçµæœã®è¦ç´„
```
æä¾›ã•ã‚ŒãŸç§˜å¯†éµã¯: âœ… å®Œå…¨ã«æ­£å¸¸
æœ€åˆã®ã‚¨ãƒ©ãƒ¼ã®åŸå› : ç§˜å¯†éµãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã‹ã£ãŸ
ä»Šå›ã®ã‚¨ãƒ©ãƒ¼ã®åŸå› : SSHè¨­å®šã®äº’æ›æ€§å•é¡Œ
è§£æ±ºæ–¹æ³•: HostKeyAlgorithms=+ssh-rsa ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ 
```

### æ¨å¥¨ã•ã‚Œã‚‹æœ€çµ‚ã‚³ãƒãƒ³ãƒ‰
```bash
ssh -i ~/.ssh/console_key \
    -o HostKeyAlgorithms=+ssh-rsa \
    -o PubkeyAcceptedAlgorithms=+ssh-rsa \
    -o ProxyCommand='ssh -i ~/.ssh/console_key -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa -W %h:%p -p 443 ocid1.instanceconsoleconnection.oc1.ap-tokyo-1.anxhiljrtc2ci5ac3xvxpnpdtxl3h4atdwcswf7w3a4kp5c2qkachqbtnzfq@instance-console.ap-tokyo-1.oci.oraclecloud.com' \
    ocid1.instance.oc1.ap-tokyo-1.anxhiljrtc2ci5acbpj3zsrtxhkng5qabyauegqk42rehbwqyu3xnrhpjt2a
```

**ã“ã®è¨­å®šã§æ¥ç¶šå¯èƒ½ã«ãªã‚Šã¾ã™ï¼**
