# AWS IAM Advanced ãƒãƒ³ã‚ºã‚ªãƒ³ã‚¬ã‚¤ãƒ‰

> **å¯¾è±¡**: AWS DevOps Professional (DOP-C02) è©¦é¨“å¯¾ç­–
> **å‰æçŸ¥è­˜**: IAMåŸºç¤ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ãƒ­ãƒ¼ãƒ«ã€ãƒãƒªã‚·ãƒ¼ï¼‰ã€AWS Organizations
> **æ‰€è¦æ™‚é–“**: ç´„3æ™‚é–“

---

## ç›®æ¬¡

1. [IAMãƒãƒªã‚·ãƒ¼è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯](#1-iamãƒãƒªã‚·ãƒ¼è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯)
2. [Permission Boundaries](#2-permission-boundaries)
3. [ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹](#3-ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹)
4. [ABACï¼ˆå±æ€§ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰](#4-abacå±æ€§ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡)
5. [Identity Federation](#5-identity-federation)
6. [STSï¼ˆSecurity Token Serviceï¼‰](#6-stssecurity-token-service)
7. [IAM Access Analyzer](#7-iam-access-analyzer)
8. [ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’](#8-ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’)
9. [DOPè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#9-dopè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)

---

## 1. IAMãƒãƒªã‚·ãƒ¼è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯

### 1.1 ãƒãƒªã‚·ãƒ¼è©•ä¾¡ãƒ•ãƒ­ãƒ¼

```
ã€IAMãƒãƒªã‚·ãƒ¼è©•ä¾¡ã®å®Œå…¨ãƒ•ãƒ­ãƒ¼ã€‘

ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ˜ç¤ºçš„Deny?       â”‚â”€â”€Yesâ”€â”€â–¶ ğŸš« DENY
â”‚    (å…¨ãƒãƒªã‚·ãƒ¼)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ No
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. SCP (Organizations)â”‚â”€â”€Denyâ”€â”€â–¶ ğŸš« DENY
â”‚    (è©²å½“ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®  â”‚
â”‚     å…¨SCP)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Allow
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹     â”‚â”€â”€Allowâ”€â”€â–¶ âœ… ALLOW
â”‚    ãƒãƒªã‚·ãƒ¼?         â”‚  (åŒä¸€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…)
â”‚    (S3, KMS, SQSç­‰)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ ãªã—/Deny
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Permission Boundaryâ”‚â”€â”€Denyâ”€â”€â–¶ ğŸš« DENY
â”‚    (è¨­å®šã•ã‚Œã¦ã„ã‚‹    â”‚
â”‚     å ´åˆ)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Allow
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ â”‚â”€â”€Denyâ”€â”€â–¶ ğŸš« DENY
â”‚    (AssumeRoleæ™‚ã®    â”‚
â”‚     ãƒãƒªã‚·ãƒ¼)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Allow
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼   â”‚â”€â”€Allowâ”€â”€â–¶ âœ… ALLOW
â”‚    (IAMãƒãƒªã‚·ãƒ¼)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ ãªã—
          â–¼
       ğŸš« æš—é»™çš„DENYï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
```

### 1.2 ãƒãƒªã‚·ãƒ¼ã®ç¨®é¡ã¨é©ç”¨ç¯„å›²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IAMãƒãƒªã‚·ãƒ¼ã®åˆ†é¡                                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ï¼ˆIDãƒ™ãƒ¼ã‚¹ï¼‰                            â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚ â”‚ ç®¡ç†ãƒãƒªã‚·ãƒ¼ â”‚ â”‚ ç®¡ç†ãƒãƒªã‚·ãƒ¼ â”‚ â”‚ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³Polâ”‚            â”‚   â”‚
â”‚  â”‚ â”‚ (AWSç®¡ç†)   â”‚ â”‚ (ã‚«ã‚¹ã‚¿ãƒãƒ¼)â”‚ â”‚             â”‚            â”‚   â”‚
â”‚  â”‚ â”‚             â”‚ â”‚             â”‚ â”‚ 1å¯¾1ã§åŸ‹è¾¼  â”‚            â”‚   â”‚
â”‚  â”‚ â”‚ å†åˆ©ç”¨å¯    â”‚ â”‚ å†åˆ©ç”¨å¯    â”‚ â”‚ å‰Šé™¤ã§æ¶ˆãˆã‚‹â”‚            â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹                                                â”‚   â”‚
â”‚  â”‚ S3ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼, KMSã‚­ãƒ¼ãƒãƒªã‚·ãƒ¼, SQSã‚­ãƒ¥ãƒ¼ãƒãƒªã‚·ãƒ¼,       â”‚   â”‚
â”‚  â”‚ Lambdaé–¢æ•°ãƒãƒªã‚·ãƒ¼, SNSãƒˆãƒ”ãƒƒã‚¯ãƒãƒªã‚·ãƒ¼, API GWãƒªã‚½ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼â”‚   â”‚
â”‚  â”‚ â€» Principalãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å«ã‚€                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Permission Boundaryï¼ˆæ¨©é™ã®å¢ƒç•Œï¼‰                             â”‚   â”‚
â”‚  â”‚ IAMãƒ¦ãƒ¼ã‚¶ãƒ¼/ãƒ­ãƒ¼ãƒ«ã«è¨­å®šã€‚IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ã®ä¸Šé™ã‚’åˆ¶é™ã€‚       â”‚   â”‚
â”‚  â”‚ æœ‰åŠ¹ãªæ¨©é™ = IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ âˆ© Permission Boundary           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SCP (Service Control Policy) - Organizations                  â”‚   â”‚
â”‚  â”‚ OU/ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã§æœ€å¤§æ¨©é™ã‚’åˆ¶é™ã€‚                         â”‚   â”‚
â”‚  â”‚ ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯é©ç”¨ã•ã‚Œãªã„ã€‚                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼                                            â”‚   â”‚
â”‚  â”‚ AssumeRole, GetFederationToken æ™‚ã«æ¸¡ã™ä¸€æ™‚çš„ãªãƒãƒªã‚·ãƒ¼ã€‚     â”‚   â”‚
â”‚  â”‚ ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã‚’ã•ã‚‰ã«çµã‚Šè¾¼ã‚€ã€‚                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 DOPè©¦é¨“ã§ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

| ãƒˆãƒ”ãƒƒã‚¯ | é‡è¦åº¦ | å‡ºé¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ |
|---------|--------|-------------|
| **ãƒãƒªã‚·ãƒ¼è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯** | â˜…â˜…â˜…â˜…â˜… | æ˜ç¤ºçš„Deny > SCP > ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ > PB > IDãƒ™ãƒ¼ã‚¹ |
| **Permission Boundaries** | â˜…â˜…â˜…â˜…â˜… | æ¨©é™å§”ä»»ã€é–‹ç™ºè€…ã¸ã®åˆ¶é™ |
| **ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«** | â˜…â˜…â˜…â˜…â˜… | AssumeRoleã€ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ |
| **ABAC** | â˜…â˜…â˜…â˜…â˜† | ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ |
| **SCP** | â˜…â˜…â˜…â˜…â˜… | Organizationsé€£æºï¼ˆåˆ¥ã‚¬ã‚¤ãƒ‰å‚ç…§ï¼‰ |
| **IAM Access Analyzer** | â˜…â˜…â˜…â˜…â˜† | å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ã®æ¤œå‡º |
| **STS** | â˜…â˜…â˜…â˜…â˜† | ä¸€æ™‚èªè¨¼æƒ…å ±ã€ExternalId |
| **Identity Federation** | â˜…â˜…â˜…â˜†â˜† | SAML, OIDC, Cognito |

---

## 2. Permission Boundaries

### 2.1 æ¦‚è¦

```
ã€Permission Boundaryã®å‹•ä½œã€‘

IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼         Permission Boundary
(ãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒ)       (ãƒ­ãƒ¼ãƒ«ã«è¨­å®š)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… s3:*          â”‚    â”‚ âœ… s3:GetObject  â”‚
â”‚ âœ… ec2:*         â”‚    â”‚ âœ… s3:PutObject  â”‚
â”‚ âœ… lambda:*      â”‚    â”‚ âœ… lambda:*      â”‚
â”‚ âœ… dynamodb:*    â”‚    â”‚ âœ… dynamodb:Get* â”‚
â”‚ âœ… iam:*         â”‚    â”‚ âŒ iam:*         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ äº¤å·®ï¼ˆIntersectionï¼‰
                     â–¼
            æœ‰åŠ¹ãªæ¨©é™
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ âœ… s3:GetObject  â”‚ â† ä¸¡æ–¹ã«ã‚ã‚‹
            â”‚ âœ… s3:PutObject  â”‚ â† ä¸¡æ–¹ã«ã‚ã‚‹
            â”‚ âœ… lambda:*      â”‚ â† ä¸¡æ–¹ã«ã‚ã‚‹
            â”‚ âœ… dynamodb:Get* â”‚ â† PBå´ã§åˆ¶é™
            â”‚ âŒ ec2:*         â”‚ â† PBã«ãªã„
            â”‚ âŒ iam:*         â”‚ â† PBã«ãªã„
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Permission Boundaryã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

```
ã€æ¨©é™å§”ä»»ãƒ‘ã‚¿ãƒ¼ãƒ³ - é–‹ç™ºè€…ã«IAMãƒ­ãƒ¼ãƒ«ä½œæˆã‚’è¨±å¯ã€‘

ç®¡ç†è€…ãŒè¨­å®š:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é–‹ç™ºè€…IAMãƒ­ãƒ¼ãƒ«                              â”‚
â”‚                                             â”‚
â”‚ IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼:                            â”‚
â”‚   - iam:CreateRole (Conditionä»˜ã)          â”‚
â”‚   - iam:AttachRolePolicy                    â”‚
â”‚   - iam:PutRolePermissionsBoundary          â”‚
â”‚                                             â”‚
â”‚ Permission Boundary:                         â”‚
â”‚   - s3:*, lambda:*, dynamodb:*              â”‚
â”‚   - NOT iam:*, organizations:*              â”‚
â”‚                                             â”‚
â”‚ Condition:                                   â”‚
â”‚   iam:PermissionsBoundary =                 â”‚
â”‚     arn:aws:iam::xxx:policy/dev-boundary    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é–‹ç™ºè€…ãŒä½œæˆã™ã‚‹ãƒ­ãƒ¼ãƒ«:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ï¼ˆé–‹ç™ºè€…ãŒä½œæˆï¼‰             â”‚
â”‚                                             â”‚
â”‚ IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼: s3:GetObject, dynamodb:*  â”‚
â”‚ Permission Boundary: dev-boundary (å¼·åˆ¶)     â”‚
â”‚                                             â”‚
â”‚ â†’ é–‹ç™ºè€…ã¯PBã§è¨±å¯ã•ã‚ŒãŸç¯„å›²å†…ã§ã®ã¿         â”‚
â”‚   ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆå¯èƒ½                           â”‚
â”‚ â†’ IAMã‚„Organizationsæ“ä½œã¯ä¸å¯èƒ½             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Permission Boundaryå¼·åˆ¶ã®IAMãƒãƒªã‚·ãƒ¼

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowCreateRoleWithBoundary",
      "Effect": "Allow",
      "Action": [
        "iam:CreateRole",
        "iam:AttachRolePolicy",
        "iam:DetachRolePolicy"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "iam:PermissionsBoundary": "arn:aws:iam::123456789012:policy/dev-boundary"
        }
      }
    },
    {
      "Sid": "DenyBoundaryChange",
      "Effect": "Deny",
      "Action": [
        "iam:DeleteRolePermissionsBoundary",
        "iam:PutRolePermissionsBoundary"
      ],
      "Resource": "*",
      "Condition": {
        "StringNotEquals": {
          "iam:PermissionsBoundary": "arn:aws:iam::123456789012:policy/dev-boundary"
        }
      }
    }
  ]
}
```

---

## 3. ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹

### 3.1 AssumeRoleã«ã‚ˆã‚‹ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹

```
ã€ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆAssumeRoleã€‘

Account A (111111111111)          Account B (222222222222)
ã‚½ãƒ¼ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ                   ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚            â”‚                    â”‚
â”‚ IAM User/Role      â”‚            â”‚ IAM Role           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  1.Assume  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ IDãƒãƒªã‚·ãƒ¼    â”‚   â”‚â”€â”€â”€Roleâ”€â”€â”€â”€â–¶â”‚ â”‚ ä¿¡é ¼ãƒãƒªã‚·ãƒ¼  â”‚   â”‚
â”‚ â”‚              â”‚   â”‚            â”‚ â”‚ (Trust)      â”‚   â”‚
â”‚ â”‚ sts:Assume   â”‚   â”‚  2.ä¸€æ™‚    â”‚ â”‚              â”‚   â”‚
â”‚ â”‚ Roleè¨±å¯     â”‚   â”‚â—€â”€èªè¨¼æƒ…å ±â”€â”‚ â”‚ Account Aã‚’  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚            â”‚ â”‚ è¨±å¯         â”‚   â”‚
â”‚                    â”‚            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ 3.ä¸€æ™‚èªè¨¼æƒ…å ±ã§   â”‚            â”‚                    â”‚
â”‚   Account Bã®      â”‚            â”‚ IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼   â”‚
â”‚   ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹â”‚            â”‚ â†’ å®Ÿéš›ã®æ¨©é™      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¿…è¦ãªè¨­å®š:
1. Account B: ãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã§Account Aã‚’è¨±å¯
2. Account A: IAMãƒãƒªã‚·ãƒ¼ã§sts:AssumeRoleã‚’è¨±å¯
```

### 3.2 ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ï¼ˆTrust Policyï¼‰

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::111111111111:role/DeploymentRole"
      },
      "Action": "sts:AssumeRole",
      "Condition": {
        "StringEquals": {
          "sts:ExternalId": "unique-external-id-12345"
        }
      }
    }
  ]
}
```

### 3.3 ExternalIdï¼ˆæ··ä¹±ã—ãŸä»£ç†å•é¡Œã®å¯¾ç­–ï¼‰

```
ã€æ··ä¹±ã—ãŸä»£ç†å•é¡Œ (Confused Deputy Problem)ã€‘

â–  å•é¡Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ”»æ’ƒè€…ã®   â”‚    â”‚ ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£â”‚    â”‚ ã‚ãªãŸã®   â”‚
â”‚ Account    â”‚â”€â”€â”€â–¶â”‚ ã‚µãƒ¼ãƒ“ã‚¹    â”‚â”€â”€â”€â–¶â”‚ Account    â”‚
â”‚            â”‚    â”‚ (æ­£è¦)      â”‚    â”‚ (è¢«å®³è€…)   â”‚
â”‚ æ”»æ’ƒè€…ãŒ   â”‚    â”‚             â”‚    â”‚            â”‚
â”‚ ã‚ãªãŸã®   â”‚    â”‚ ãƒ­ãƒ¼ãƒ«ARNã‚’ â”‚    â”‚ ãƒ­ãƒ¼ãƒ«ã‚’   â”‚
â”‚ ãƒ­ãƒ¼ãƒ«ARNã‚’â”‚    â”‚ çŸ¥ã£ã¦ã„ã‚‹  â”‚    â”‚ AssumeRole â”‚
â”‚ ã‚µãƒ¼ãƒ“ã‚¹ã« â”‚    â”‚ ã ã‘ã§      â”‚    â”‚            â”‚
â”‚ ä¼ãˆã‚‹     â”‚    â”‚ AssumeRole  â”‚    â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â–  è§£æ±ºç­–: ExternalId
- ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã«ExternalIdæ¡ä»¶ã‚’è¿½åŠ 
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã¨ã‚ãªãŸã®é–“ã§å…±æœ‰ã™ã‚‹ä¸€æ„ã®ID
- æ”»æ’ƒè€…ã¯ExternalIdã‚’çŸ¥ã‚‰ãªã„ãŸã‚AssumeRoleä¸å¯
```

### 3.4 ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒ

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | æ–¹å¼ | ç”¨é€” |
|---------|------|------|
| AssumeRole | STS | æ±ç”¨çš„ãªã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹ |
| ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ | S3, KMS, SQSç­‰ | ç‰¹å®šãƒªã‚½ãƒ¼ã‚¹ã®ç›´æ¥å…±æœ‰ |
| Organizationsä¿¡é ¼ã‚¢ã‚¯ã‚»ã‚¹ | AWS Services | ã‚µãƒ¼ãƒ“ã‚¹ã®Orgå…¨ä½“æœ‰åŠ¹åŒ– |
| RAM (Resource Access Manager) | ãƒªã‚½ãƒ¼ã‚¹å…±æœ‰ | VPCã‚µãƒ–ãƒãƒƒãƒˆã€Transit GWç­‰ |

---

## 4. ABACï¼ˆå±æ€§ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰

### 4.1 RBAC vs ABAC

```
ã€RBAC (Role-Based Access Control)ã€‘
- ãƒ­ãƒ¼ãƒ«ã”ã¨ã«ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆ
- ãƒªã‚½ãƒ¼ã‚¹è¿½åŠ æ™‚ã«ãƒãƒªã‚·ãƒ¼æ›´æ–°ãŒå¿…è¦
- ãƒ­ãƒ¼ãƒ«æ•° Ã— ãƒªã‚½ãƒ¼ã‚¹ ã®çµ„ã¿åˆã‚ã›çˆ†ç™º

ä¾‹: 3ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ Ã— 3ç’°å¢ƒ = 9ãƒãƒªã‚·ãƒ¼å¿…è¦

ã€ABAC (Attribute-Based Access Control)ã€‘
- ã‚¿ã‚°å±æ€§ã«åŸºã¥ãã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ãƒªã‚½ãƒ¼ã‚¹è¿½åŠ æ™‚ã«ãƒãƒªã‚·ãƒ¼æ›´æ–°ä¸è¦
- ã‚¿ã‚°ä»˜ã‘ã ã‘ã§æ¨©é™ãŒè‡ªå‹•é©ç”¨

ä¾‹: 1ã¤ã®ãƒãƒªã‚·ãƒ¼ã§å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»å…¨ç’°å¢ƒã«å¯¾å¿œ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ABAC ãƒãƒªã‚·ãƒ¼ä¾‹                                       â”‚
â”‚                                                      â”‚
â”‚ Condition:                                           â”‚
â”‚   StringEquals:                                      â”‚
â”‚     "aws:ResourceTag/Project":                       â”‚
â”‚       "${aws:PrincipalTag/Project}"                  â”‚
â”‚     "aws:ResourceTag/Environment":                   â”‚
â”‚       "${aws:PrincipalTag/Environment}"              â”‚
â”‚                                                      â”‚
â”‚ â†’ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®ã‚¿ã‚°ã¨ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¿ã‚°ãŒä¸€è‡´ã™ã‚Œã°è¨±å¯  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ABACãƒãƒªã‚·ãƒ¼ä¾‹

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowActionsMatchingTags",
      "Effect": "Allow",
      "Action": [
        "ec2:StartInstances",
        "ec2:StopInstances",
        "ec2:RebootInstances"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:ResourceTag/Project": "${aws:PrincipalTag/Project}",
          "aws:ResourceTag/Environment": "${aws:PrincipalTag/Environment}"
        }
      }
    },
    {
      "Sid": "AllowDescribe",
      "Effect": "Allow",
      "Action": "ec2:Describe*",
      "Resource": "*"
    }
  ]
}
```

### 4.3 ABACç”¨ã®ä¸»è¦æ¡ä»¶ã‚­ãƒ¼

| æ¡ä»¶ã‚­ãƒ¼ | èª¬æ˜ |
|---------|------|
| `aws:PrincipalTag/KEY` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆå…ƒã®ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®ã‚¿ã‚° |
| `aws:ResourceTag/KEY` | æ“ä½œå¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¿ã‚° |
| `aws:RequestTag/KEY` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æŒ‡å®šã•ã‚ŒãŸã‚¿ã‚° |
| `aws:TagKeys` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã‚¿ã‚°ã‚­ãƒ¼ã®ä¸€è¦§ |
| `iam:ResourceTag/KEY` | IAMãƒªã‚½ãƒ¼ã‚¹è‡ªä½“ã®ã‚¿ã‚° |

---

## 5. Identity Federation

### 5.1 ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ–¹å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Identity Federation ã®æ–¹å¼                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. SAML 2.0 Federation                                      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ ä¼æ¥­IdP (ADç­‰)                                               â”‚   â”‚
â”‚  â”‚    â”‚                                                         â”‚   â”‚
â”‚  â”‚    â–¼ SAMLã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³                                        â”‚   â”‚
â”‚  â”‚ AWS STS (AssumeRoleWithSAML)                                 â”‚   â”‚
â”‚  â”‚    â”‚                                                         â”‚   â”‚
â”‚  â”‚    â–¼ ä¸€æ™‚èªè¨¼æƒ…å ±                                            â”‚   â”‚
â”‚  â”‚ AWSãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹                                        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ ç”¨é€”: ä¼æ¥­ã®SSOã€ADé€£æº                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. Web Identity Federation (OIDC)                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ OIDCãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ (Google, Facebook, GitHubç­‰)                 â”‚   â”‚
â”‚  â”‚    â”‚                                                         â”‚   â”‚
â”‚  â”‚    â–¼ IDãƒˆãƒ¼ã‚¯ãƒ³                                              â”‚   â”‚
â”‚  â”‚ AWS STS (AssumeRoleWithWebIdentity)                          â”‚   â”‚
â”‚  â”‚    â”‚                                                         â”‚   â”‚
â”‚  â”‚    â–¼ ä¸€æ™‚èªè¨¼æƒ…å ±                                            â”‚   â”‚
â”‚  â”‚ AWSãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹                                        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ ç”¨é€”: ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã€Webã‚¢ãƒ—ãƒª                               â”‚   â”‚
â”‚  â”‚ æ¨å¥¨: Amazon CognitoçµŒç”±ã§ä½¿ç”¨                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3. Amazon Cognito                                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«: èªè¨¼ï¼ˆã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—/ã‚µã‚¤ãƒ³ã‚¤ãƒ³ï¼‰               â”‚   â”‚
â”‚  â”‚ IDãƒ—ãƒ¼ãƒ«: èªå¯ï¼ˆä¸€æ™‚AWSèªè¨¼æƒ…å ±ã®ç™ºè¡Œï¼‰                      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ ç”¨é€”: ãƒ¢ãƒã‚¤ãƒ«/Webã‚¢ãƒ—ãƒªã®èªè¨¼ãƒ»èªå¯çµ±åˆ                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 4. IAM Identity Center (æ—§ AWS SSO)                          â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ Organizationså…¨ä½“ã®SSOç®¡ç†                                   â”‚   â”‚
â”‚  â”‚ å¤–éƒ¨IdPé€£æº or å†…è”µãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª                              â”‚   â”‚
â”‚  â”‚ Permission Sets ã§ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†                               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ ç”¨é€”: ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆç’°å¢ƒã®ä¸€å…ƒçš„ãªã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 SAML 2.0 ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼

```
ã€SAML 2.0 Federation ãƒ•ãƒ­ãƒ¼ã€‘

ãƒ¦ãƒ¼ã‚¶ãƒ¼        ä¼æ¥­IdP        AWS STS       AWSãƒªã‚½ãƒ¼ã‚¹
   â”‚              â”‚              â”‚              â”‚
   â”‚ 1.ãƒ­ã‚°ã‚¤ãƒ³   â”‚              â”‚              â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚              â”‚
   â”‚              â”‚              â”‚              â”‚
   â”‚ 2.SAMLã‚¢ã‚µãƒ¼ â”‚              â”‚              â”‚
   â”‚   ã‚·ãƒ§ãƒ³ç™ºè¡Œ â”‚              â”‚              â”‚
   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚              â”‚
   â”‚              â”‚              â”‚              â”‚
   â”‚ 3.AssumeRoleWithSAML        â”‚              â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
   â”‚              â”‚              â”‚              â”‚
   â”‚ 4.ä¸€æ™‚èªè¨¼æƒ…å ±              â”‚              â”‚
   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
   â”‚              â”‚              â”‚              â”‚
   â”‚ 5.APIã‚³ãƒ¼ãƒ«                                â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚              â”‚              â”‚              â”‚
```

---

## 6. STSï¼ˆSecurity Token Serviceï¼‰

### 6.1 STS APIã®ä¸€è¦§

| API | ç”¨é€” | èªè¨¼æƒ…å ±ã®æœ‰åŠ¹æœŸé–“ |
|-----|------|------------------|
| `AssumeRole` | ãƒ­ãƒ¼ãƒ«ã®å¼•ãå—ã‘ | 15åˆ†ã€œ12æ™‚é–“ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1æ™‚é–“ï¼‰ |
| `AssumeRoleWithSAML` | SAMLèªè¨¼å¾Œã®ãƒ­ãƒ¼ãƒ«å¼•ãå—ã‘ | 15åˆ†ã€œ12æ™‚é–“ |
| `AssumeRoleWithWebIdentity` | OIDCèªè¨¼å¾Œã®ãƒ­ãƒ¼ãƒ«å¼•ãå—ã‘ | 15åˆ†ã€œ12æ™‚é–“ |
| `GetSessionToken` | MFAèªè¨¼ã®ä¸€æ™‚èªè¨¼æƒ…å ± | 15åˆ†ã€œ36æ™‚é–“ |
| `GetFederationToken` | ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ | 15åˆ†ã€œ36æ™‚é–“ |
| `GetCallerIdentity` | å‘¼ã³å‡ºã—å…ƒã®ç¢ºèª | - |
| `DecodeAuthorizationMessage` | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¾©å· | - |

### 6.2 ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé–“ã®åˆ¶å¾¡

```
ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé–“ã®åˆ¶å¾¡éšå±¤ã€‘

ãƒ­ãƒ¼ãƒ«ã®æœ€å¤§ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé–“ï¼ˆMaxSessionDurationï¼‰
  â†’ 1ã€œ12æ™‚é–“ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1æ™‚é–“ï¼‰
  â†’ ãƒ­ãƒ¼ãƒ«ä½œæˆ/æ›´æ–°æ™‚ã«è¨­å®š

AssumeRoleæ™‚ã®DurationSeconds
  â†’ MaxSessionDurationä»¥ä¸‹ã®å€¤ã‚’æŒ‡å®š
  â†’ æŒ‡å®šã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1æ™‚é–“

ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼
  â†’ AssumeRoleæ™‚ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ¸¡ã™
  â†’ ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã‚’ã•ã‚‰ã«åˆ¶é™
  â†’ æ¨©é™ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯ã§ããªã„
```

---

## 7. IAM Access Analyzer

### 7.1 æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IAM Access Analyzer                               â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹åˆ†æ                                              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ ä¿¡é ¼ã‚¾ãƒ¼ãƒ³å¤–ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªãƒªã‚½ãƒ¼ã‚¹ã‚’æ¤œå‡º:                  â”‚   â”‚
â”‚  â”‚ - S3ãƒã‚±ãƒƒãƒˆï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯/ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰                    â”‚   â”‚
â”‚  â”‚ - IAMãƒ­ãƒ¼ãƒ«ï¼ˆå¤–éƒ¨ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒå¼•ãå—ã‘å¯èƒ½ï¼‰                 â”‚   â”‚
â”‚  â”‚ - KMSã‚­ãƒ¼ï¼ˆå¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ï¼‰                                â”‚   â”‚
â”‚  â”‚ - Lambdaé–¢æ•°ï¼ˆå¤–éƒ¨å‘¼ã³å‡ºã—è¨±å¯ï¼‰                              â”‚   â”‚
â”‚  â”‚ - SQSã‚­ãƒ¥ãƒ¼ã€SNSãƒˆãƒ”ãƒƒã‚¯                                     â”‚   â”‚
â”‚  â”‚ - EBS/RDSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯å…±æœ‰ï¼‰                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æœªä½¿ç”¨ã‚¢ã‚¯ã‚»ã‚¹åˆ†æ                                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ - æœªä½¿ç”¨ã®ãƒ­ãƒ¼ãƒ«                                              â”‚   â”‚
â”‚  â”‚ - æœªä½¿ç”¨ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼                                       â”‚   â”‚
â”‚  â”‚ - æœªä½¿ç”¨ã®æ¨©é™                                               â”‚   â”‚
â”‚  â”‚ â†’ æœ€å°æ¨©é™ã®å®Ÿç¾ã‚’æ”¯æ´                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ãƒãƒªã‚·ãƒ¼ç”Ÿæˆ                                                  â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ CloudTrailãƒ­ã‚°ã‹ã‚‰å®Ÿéš›ã®APIä½¿ç”¨ã‚’åˆ†æã—                       â”‚   â”‚
â”‚  â”‚ æœ€å°æ¨©é™ã®IAMãƒãƒªã‚·ãƒ¼ã‚’è‡ªå‹•ç”Ÿæˆ                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ãƒãƒªã‚·ãƒ¼æ¤œè¨¼                                                  â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ IAMãƒãƒªã‚·ãƒ¼ã®æ–‡æ³•ãƒã‚§ãƒƒã‚¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Šã€                 â”‚   â”‚
â”‚  â”‚ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é•åã®æ¤œå‡º                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 EventBridgeé€£æº

```
Access Analyzer         EventBridge              Lambda/SNS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Findingç”Ÿæˆ  â”‚    â”‚ ãƒ‘ã‚¿ãƒ¼ãƒ³:          â”‚    â”‚ é€šçŸ¥/ä¿®å¾©    â”‚
â”‚ (å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹â”‚â”€â”€â”€â–¶â”‚ source:            â”‚â”€â”€â”€â–¶â”‚              â”‚
â”‚  æ¤œå‡º)       â”‚    â”‚  aws.access-analyzerâ”‚   â”‚ Slacké€šçŸ¥    â”‚
â”‚              â”‚    â”‚ detail.status:     â”‚    â”‚ ãƒã‚±ãƒƒãƒˆä½œæˆ â”‚
â”‚              â”‚    â”‚  ACTIVE            â”‚    â”‚ è‡ªå‹•ä¿®å¾©     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’

### æ¼”ç¿’1: ãƒãƒªã‚·ãƒ¼è©•ä¾¡ã®ç¢ºèª

```bash
# 1. ç¾åœ¨ã®å‘¼ã³å‡ºã—å…ƒã®ç¢ºèª
aws sts get-caller-identity

# 2. ãƒãƒªã‚·ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆCLIç‰ˆï¼‰
aws iam simulate-principal-policy \
  --policy-source-arn "arn:aws:iam::$(aws sts get-caller-identity --query Account --output text):user/$(aws sts get-caller-identity --query Arn --output text | cut -d/ -f2)" \
  --action-names "s3:GetObject" "s3:PutObject" "ec2:DescribeInstances" \
  --query 'EvaluationResults[].{Action:EvalActionName,Decision:EvalDecision}'

# 3. ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
aws iam simulate-principal-policy \
  --policy-source-arn "arn:aws:iam::$(aws sts get-caller-identity --query Account --output text):role/AdminRole" \
  --action-names "s3:GetObject" \
  --resource-arns "arn:aws:s3:::my-bucket/secret.txt" \
  --query 'EvaluationResults[].{Action:EvalActionName,Decision:EvalDecision}'
```

### æ¼”ç¿’2: Permission Boundary

```bash
ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)

# 1. Permission Boundaryç”¨ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ
aws iam create-policy \
  --policy-name "dev-boundary" \
  --policy-document '{
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": [
          "s3:*",
          "lambda:*",
          "dynamodb:*",
          "logs:*",
          "cloudwatch:*"
        ],
        "Resource": "*"
      },
      {
        "Effect": "Deny",
        "Action": [
          "iam:*",
          "organizations:*",
          "account:*"
        ],
        "Resource": "*"
      }
    ]
  }'

# 2. ãƒ­ãƒ¼ãƒ«ã«Permission Boundaryã‚’è¨­å®š
aws iam put-role-permissions-boundary \
  --role-name "DevRole" \
  --permissions-boundary "arn:aws:iam::${ACCOUNT_ID}:policy/dev-boundary"

# 3. Permission Boundaryã®ç¢ºèª
aws iam get-role \
  --role-name "DevRole" \
  --query 'Role.PermissionsBoundary'

# 4. Permission Boundaryã®å‰Šé™¤
aws iam delete-role-permissions-boundary \
  --role-name "DevRole"
```

### æ¼”ç¿’3: ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«

```bash
# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ­ãƒ¼ãƒ«ä½œæˆ
aws iam create-role \
  --role-name "CrossAccountDeployRole" \
  --assume-role-policy-document '{
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Principal": {
          "AWS": "arn:aws:iam::111111111111:root"
        },
        "Action": "sts:AssumeRole",
        "Condition": {
          "StringEquals": {
            "sts:ExternalId": "deploy-ext-id-2026"
          }
        }
      }
    ]
  }'

# ã‚½ãƒ¼ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰AssumeRole
aws sts assume-role \
  --role-arn "arn:aws:iam::222222222222:role/CrossAccountDeployRole" \
  --role-session-name "deploy-session" \
  --external-id "deploy-ext-id-2026" \
  --duration-seconds 3600 \
  --query 'Credentials.{AccessKey:AccessKeyId,SecretKey:SecretAccessKey,Token:SessionToken}'

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’ä»˜ã‘ã¦AssumeRoleï¼ˆæ¨©é™ã‚’çµã‚Šè¾¼ã‚€ï¼‰
aws sts assume-role \
  --role-arn "arn:aws:iam::222222222222:role/CrossAccountDeployRole" \
  --role-session-name "limited-session" \
  --external-id "deploy-ext-id-2026" \
  --policy '{
    "Version": "2012-10-17",
    "Statement": [{
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::target-bucket/*"
    }]
  }'
```

### æ¼”ç¿’4: ABACè¨­å®š

```bash
# 1. ã‚¿ã‚°ä»˜ãIAMãƒ­ãƒ¼ãƒ«ã®ä½œæˆ
aws iam create-role \
  --role-name "ProjectAlpha-Dev" \
  --assume-role-policy-document '{
    "Version": "2012-10-17",
    "Statement": [{
      "Effect": "Allow",
      "Principal": {"AWS": "arn:aws:iam::'${ACCOUNT_ID}':root"},
      "Action": "sts:AssumeRole"
    }]
  }' \
  --tags '[
    {"Key": "Project", "Value": "Alpha"},
    {"Key": "Environment", "Value": "Dev"}
  ]'

# 2. ABACãƒãƒªã‚·ãƒ¼ã®ä½œæˆ
aws iam create-policy \
  --policy-name "abac-ec2-policy" \
  --policy-document '{
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": ["ec2:StartInstances", "ec2:StopInstances"],
        "Resource": "*",
        "Condition": {
          "StringEquals": {
            "aws:ResourceTag/Project": "${aws:PrincipalTag/Project}",
            "aws:ResourceTag/Environment": "${aws:PrincipalTag/Environment}"
          }
        }
      },
      {
        "Effect": "Allow",
        "Action": "ec2:Describe*",
        "Resource": "*"
      }
    ]
  }'

# 3. ãƒãƒªã‚·ãƒ¼ã‚’ãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒ
aws iam attach-role-policy \
  --role-name "ProjectAlpha-Dev" \
  --policy-arn "arn:aws:iam::${ACCOUNT_ID}:policy/abac-ec2-policy"
```

### æ¼”ç¿’5: IAM Access Analyzer

```bash
# 1. ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®ä½œæˆï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ï¼‰
aws accessanalyzer create-analyzer \
  --analyzer-name "account-analyzer" \
  --type ACCOUNT

# 2. ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ä¸€è¦§ã®ç¢ºèª
aws accessanalyzer list-analyzers \
  --query 'analyzers[].{Name:name,Type:type,Status:status}'

# 3. Findingã®ç¢ºèª
aws accessanalyzer list-findings \
  --analyzer-arn "arn:aws:access-analyzer:ap-northeast-1:${ACCOUNT_ID}:analyzer/account-analyzer" \
  --query 'findings[].{Resource:resource,Type:resourceType,Status:status,Principal:principal}'

# 4. ãƒãƒªã‚·ãƒ¼ã®æ¤œè¨¼
aws accessanalyzer validate-policy \
  --policy-type IDENTITY_POLICY \
  --policy-document '{
    "Version": "2012-10-17",
    "Statement": [{
      "Effect": "Allow",
      "Action": "*",
      "Resource": "*"
    }]
  }' \
  --query 'findings[].{Type:findingType,Message:issueCode,Details:findingDetails}'

# 5. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
aws accessanalyzer delete-analyzer \
  --analyzer-name "account-analyzer"
```

### æ¼”ç¿’6: STSæ“ä½œ

```bash
# 1. ç¾åœ¨ã®èªè¨¼æƒ…å ±ç¢ºèª
aws sts get-caller-identity

# 2. èªå¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¾©å·
# ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ encoded ã®å ´åˆï¼‰
aws sts decode-authorization-message \
  --encoded-message "<encoded-error-message>" \
  --query 'DecodedMessage' \
  --output text | python3 -m json.tool

# 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ï¼ˆMFAèªè¨¼ç”¨ï¼‰
aws sts get-session-token \
  --serial-number "arn:aws:iam::${ACCOUNT_ID}:mfa/user-name" \
  --token-code 123456 \
  --duration-seconds 3600
```

---

## 9. DOPè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Q1: ãƒãƒªã‚·ãƒ¼è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯
**Q: IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã®IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ã§s3:*ã‚’Allowã—ã¦ã„ã‚‹ãŒã€Permission Boundaryã§S3ã®Readç³»ã®ã¿Allowã—ã¦ã„ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯s3:PutObjectã‚’å®Ÿè¡Œã§ãã‚‹ã‹ï¼Ÿ**

<details><summary>æ¨¡ç¯„è§£ç­”</summary>

å®Ÿè¡Œã§ããªã„ã€‚Permission BoundaryãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€æœ‰åŠ¹ãªæ¨©é™ã¯IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ã¨Permission Boundaryã®äº¤å·®ï¼ˆå…±é€šéƒ¨åˆ†ï¼‰ã«ãªã‚‹ã€‚IDãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ã§s3:*ã‚’è¨±å¯ã—ã¦ã„ã¦ã‚‚ã€Permission BoundaryãŒReadç³»ã®ã¿è¨±å¯ãªã®ã§ã€PutObjectã¯æœ‰åŠ¹ãªæ¨©é™ã«å«ã¾ã‚Œãªã„ã€‚æš—é»™çš„Denyã¨ãªã‚‹ã€‚

</details>

### Q2: Permission Boundary
**Q: é–‹ç™ºè€…ã«Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã®ä½œæˆã‚’è¨±å¯ã—ã¤ã¤ã€ä½œæˆã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã‚’åˆ¶é™ã™ã‚‹ã«ã¯ï¼Ÿ**

<details><summary>æ¨¡ç¯„è§£ç­”</summary>

Permission Boundaryã‚’ä½¿ç”¨ã™ã‚‹ã€‚â‘ åˆ¶é™ãƒãƒªã‚·ãƒ¼ï¼ˆboundaryï¼‰ã‚’ä½œæˆ â‘¡é–‹ç™ºè€…ã®IAMãƒãƒªã‚·ãƒ¼ã§iam:CreateRoleã‚’è¨±å¯ã—ã€Conditionã§iam:PermissionsBoundaryãŒç‰¹å®šã®ãƒãƒªã‚·ãƒ¼ARNã§ã‚ã‚‹å ´åˆã®ã¿è¨±å¯ã™ã‚‹ â‘¢é–‹ç™ºè€…ãŒãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹éš›ã¯å¿…ãšæŒ‡å®šã®Permission Boundaryã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ â‘£Boundaryã®å¤‰æ›´/å‰Šé™¤ã‚‚Denyã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šé–‹ç™ºè€…ã¯è‡ªç”±ã«ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã§ãã‚‹ãŒã€Boundaryå†…ã®æ¨©é™ã—ã‹ä»˜ä¸ã§ããªã„ã€‚

</details>

### Q3: ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹
**Q: Account Aã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰Account Bã®S3ãƒã‚±ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã‚’2ã¤æŒ™ã’ã‚ˆã€‚**

<details><summary>æ¨¡ç¯„è§£ç­”</summary>

â‘ AssumeRoleæ–¹å¼: Account Bã«ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’Account Aã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã§ä½œæˆã€‚EC2ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒ¼ãƒ«ã‹ã‚‰AssumeRoleã§ä¸€æ™‚èªè¨¼æƒ…å ±ã‚’å–å¾—ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã€‚â‘¡ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼æ–¹å¼: Account Bã®S3ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã§Account Aã®ãƒ­ãƒ¼ãƒ«ARNã«å¯¾ã—ã¦s3æ“ä½œã‚’è¨±å¯ã€‚EC2ã®ãƒ­ãƒ¼ãƒ«ã®IDãƒãƒªã‚·ãƒ¼ã§ã‚‚s3æ“ä½œã‚’è¨±å¯ã€‚ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼æ–¹å¼ã§ã¯AssumeRoleä¸è¦ã§ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚

</details>

### Q4: ExternalId
**Q: IAMãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã«ExternalIdã‚’è¨­å®šã™ã‚‹ç›®çš„ã¯ï¼Ÿ**

<details><summary>æ¨¡ç¯„è§£ç­”</summary>

æ··ä¹±ã—ãŸä»£ç†å•é¡Œï¼ˆConfused Deputy Problemï¼‰ã®é˜²æ­¢ã€‚ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ãŒAssumeRoleã™ã‚‹éš›ã€æ”»æ’ƒè€…ãŒä»–é¡§å®¢ã®ãƒ­ãƒ¼ãƒ«ARNã‚’ã‚µãƒ¼ãƒ“ã‚¹ã«æ¸¡ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¾—ã‚‹ã“ã¨ã‚’é˜²ãã€‚ExternalIdã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã¨é¡§å®¢é–“ã§å…±æœ‰ã™ã‚‹ç§˜å¯†ã®å€¤ã§ã€ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã®Conditionã«è¨­å®šã™ã‚‹ã€‚æ”»æ’ƒè€…ã¯ExternalIdã‚’çŸ¥ã‚‰ãªã„ãŸã‚ã€æ­£ã—ã„ãƒ­ãƒ¼ãƒ«ARNã‚’çŸ¥ã£ã¦ã„ã¦ã‚‚AssumeRoleã§ããªã„ã€‚

</details>

### Q5: ABAC
**Q: ABACã®ãƒ¡ãƒªãƒƒãƒˆã¨RBACã¨ã®é•ã„ã¯ï¼Ÿ**

<details><summary>æ¨¡ç¯„è§£ç­”</summary>

ABACã¯ã‚¿ã‚°å±æ€§ã«åŸºã¥ãã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€‚ãƒ¡ãƒªãƒƒãƒˆ: â‘ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ - ãƒªã‚½ãƒ¼ã‚¹è¿½åŠ æ™‚ã«ãƒãƒªã‚·ãƒ¼æ›´æ–°ä¸è¦ï¼ˆã‚¿ã‚°ä»˜ã‘ã®ã¿ï¼‰â‘¡ãƒãƒªã‚·ãƒ¼æ•°ã®å‰Šæ¸› - 1ã¤ã®ãƒãƒªã‚·ãƒ¼ã§è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/ç’°å¢ƒã«å¯¾å¿œ â‘¢å‹•çš„ - ã‚¿ã‚°ã®å¤‰æ›´ã ã‘ã§æ¨©é™ãŒè‡ªå‹•èª¿æ•´ã€‚RBACã¯ãƒ­ãƒ¼ãƒ«ã”ã¨ã«æ˜ç¤ºçš„ãªãƒãƒªã‚·ãƒ¼ãŒå¿…è¦ã§ã€ãƒªã‚½ãƒ¼ã‚¹ãŒå¢—ãˆã‚‹ã¨ãƒãƒªã‚·ãƒ¼ã®çµ„ã¿åˆã‚ã›ãŒçˆ†ç™ºã™ã‚‹ã€‚ABACã®æ¡ä»¶ã‚­ãƒ¼: aws:PrincipalTag, aws:ResourceTag, aws:RequestTagã€‚

</details>

### Q6: IAM Identity Center
**Q: IAM Identity Center (æ—§AWS SSO) ã®å½¹å‰²ã¨DOPã§ã®ä½ç½®ã¥ã‘ã¯ï¼Ÿ**

<details><summary>æ¨¡ç¯„è§£ç­”</summary>

IAM Identity Centerã¯Organizationså…¨ä½“ã®SSOç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã€‚Permission Setsã§å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’å®šç¾©ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚°ãƒ«ãƒ¼ãƒ—ã«å‰²ã‚Šå½“ã¦ã‚‹ã€‚å¤–éƒ¨IdPï¼ˆActive Directoryç­‰ï¼‰ã¨ã®é€£æºã‚‚å¯èƒ½ã€‚DOPã§ã®å‡ºé¡Œ: ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆç’°å¢ƒã§ã®ä¸€å…ƒçš„ãªã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ã€Permission Setsã®è¨­è¨ˆã€SAML/SCIMé€£æºã€‚Organizations + Identity Center + SCPã®çµ„ã¿åˆã‚ã›ãŒã‚¬ãƒãƒŠãƒ³ã‚¹å•é¡Œã§é »å‡ºã€‚

</details>

### Q7: STS ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼
**Q: AssumeRoleæ™‚ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’æ¸¡ã™ç›®çš„ã¨åŠ¹æœã¯ï¼Ÿ**

<details><summary>æ¨¡ç¯„è§£ç­”</summary>

ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã¯AssumeRoleæ™‚ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ¸¡ã™ãƒãƒªã‚·ãƒ¼ã§ã€ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã‚’ã•ã‚‰ã«åˆ¶é™ã™ã‚‹ã€‚æœ‰åŠ¹ãªæ¨©é™ã¯ãƒ­ãƒ¼ãƒ«ã®IDãƒãƒªã‚·ãƒ¼ âˆ© ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã¨ãªã‚‹ã€‚æ¨©é™ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯ã§ããªã„ã€‚ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹: åŒä¸€ãƒ­ãƒ¼ãƒ«ã‚’ç•°ãªã‚‹ã‚¿ã‚¹ã‚¯ã§ä½¿ç”¨ã™ã‚‹éš›ã«ã€ã‚¿ã‚¹ã‚¯ã”ã¨ã«å¿…è¦æœ€å°é™ã®æ¨©é™ã«çµã‚Šè¾¼ã‚€ã€‚ä¾‹: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ãƒ¼ãƒ«ã‚’Prodã¨Stagingã§å…±æœ‰ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ã§å¯¾è±¡ç’°å¢ƒã®ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹ã€‚

</details>

### Q8: IAM Access Analyzer
**Q: IAM Access Analyzerã®ä¸»ãªæ©Ÿèƒ½ã¨æ´»ç”¨ã‚·ãƒ¼ãƒ³ã¯ï¼Ÿ**

<details><summary>æ¨¡ç¯„è§£ç­”</summary>

ä¸»ãªæ©Ÿèƒ½: â‘ å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹åˆ†æ - ä¿¡é ¼ã‚¾ãƒ¼ãƒ³å¤–ï¼ˆä»–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/ãƒ‘ãƒ–ãƒªãƒƒã‚¯ï¼‰ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªãƒªã‚½ãƒ¼ã‚¹ã®è‡ªå‹•æ¤œå‡ºï¼ˆS3, IAMãƒ­ãƒ¼ãƒ«, KMS, Lambda, SQS, SNS, EBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç­‰ï¼‰â‘¡æœªä½¿ç”¨ã‚¢ã‚¯ã‚»ã‚¹åˆ†æ - ä½¿ã‚ã‚Œã¦ã„ãªã„ãƒ­ãƒ¼ãƒ«ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã€æ¨©é™ã®æ¤œå‡º â‘¢ãƒãƒªã‚·ãƒ¼ç”Ÿæˆ - CloudTrailãƒ­ã‚°ã‹ã‚‰æœ€å°æ¨©é™ãƒãƒªã‚·ãƒ¼ã‚’è‡ªå‹•ç”Ÿæˆ â‘£ãƒãƒªã‚·ãƒ¼æ¤œè¨¼ - IAMãƒãƒªã‚·ãƒ¼ã®æ–‡æ³•ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã€‚æ´»ç”¨: ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç›£æŸ»ã€æœ€å°æ¨©é™ã®å®Ÿç¾ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è‡ªå‹•åŒ–ã€‚EventBridgeé€£æºã§Findingæ¤œå‡ºæ™‚ã«è‡ªå‹•é€šçŸ¥ã‚‚å¯èƒ½ã€‚

</details>
