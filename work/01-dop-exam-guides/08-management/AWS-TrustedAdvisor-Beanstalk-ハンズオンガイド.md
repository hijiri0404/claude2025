# AWS Trusted Advisor & Elastic Beanstalk ãƒãƒ³ã‚ºã‚ªãƒ³ã‚¬ã‚¤ãƒ‰

> **å¯¾è±¡**: AWS DevOps Professional (DOP-C02) è©¦é¨“å¯¾ç­–
> **å‰æçŸ¥è­˜**: AWSåŸºç¤ã€IAMã€VPCã€EC2ã€S3
> **æ‰€è¦æ™‚é–“**: ç´„3.5æ™‚é–“

---

## ç›®æ¬¡

### Part 1 - Trusted Advisor
1. [Trusted Advisoræ¦‚è¦](#1-trusted-advisoræ¦‚è¦)
2. [ã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³åˆ¥ã®åˆ©ç”¨å¯èƒ½ãƒã‚§ãƒƒã‚¯](#2-ã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³åˆ¥ã®åˆ©ç”¨å¯èƒ½ãƒã‚§ãƒƒã‚¯)
3. [Trusted Advisor + EventBridgeé€£æº](#3-trusted-advisor--eventbridgeé€£æº)
4. [Organizationå˜ä½ã®Trusted Advisor](#4-organizationå˜ä½ã®trusted-advisor)

### Part 2 - Elastic Beanstalk
5. [Beanstalkæ¦‚è¦](#5-beanstalkæ¦‚è¦)
6. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼](#6-ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼)
7. [.ebextensions ã¨ Platform Hooks](#7-ebextensions-ã¨-platform-hooks)
8. [Beanstalk + Docker](#8-beanstalk--docker)
9. [Workerç’°å¢ƒ (SQSé€£æº)](#9-workerç’°å¢ƒ-sqsé€£æº)
10. [ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’](#10-ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’)
11. [DOPè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#11-dopè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)

---

# Part 1 - AWS Trusted Advisor

---

## 1. Trusted Advisoræ¦‚è¦

### 1.1 Trusted Advisorã¨ã¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AWS Trusted Advisor                               â”‚
â”‚             AWSãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹                 â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      5ã¤ã®ã‚«ãƒ†ã‚´ãƒª                                â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ â”‚
â”‚  â”‚  â”‚  ã‚³ã‚¹ãƒˆ    â”‚ â”‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³â”‚ â”‚ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚  æœ€é©åŒ–    â”‚ â”‚   ã‚¹      â”‚ â”‚            â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚            â”‚ â”‚            â”‚ â”‚            â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ æœªä½¿ç”¨     â”‚ â”‚ éå‰°/ä¸è¶³ â”‚ â”‚ è¨­å®šä¸å‚™   â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ ãƒªã‚½ãƒ¼ã‚¹   â”‚ â”‚ ãƒªã‚½ãƒ¼ã‚¹   â”‚ â”‚ è„†å¼±æ€§     â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ ç¯€ç´„ææ¡ˆ   â”‚ â”‚ æœ€é©åŒ–    â”‚ â”‚ ã‚¢ã‚¯ã‚»ã‚¹   â”‚                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚ â”‚
â”‚  â”‚  â”‚  è€éšœå®³æ€§  â”‚ â”‚ ã‚µãƒ¼ãƒ“ã‚¹  â”‚                                  â”‚ â”‚
â”‚  â”‚  â”‚            â”‚ â”‚  åˆ¶é™     â”‚                                  â”‚ â”‚
â”‚  â”‚  â”‚            â”‚ â”‚            â”‚                                  â”‚ â”‚
â”‚  â”‚  â”‚ å†—é•·æ€§     â”‚ â”‚ ã‚¯ã‚©ãƒ¼ã‚¿  â”‚                                  â”‚ â”‚
â”‚  â”‚  â”‚ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—â”‚ â”‚ ä½¿ç”¨ç‡    â”‚                                  â”‚ â”‚
â”‚  â”‚  â”‚ å¯ç”¨æ€§     â”‚ â”‚ ä¸Šé™åˆ°é”  â”‚                                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                        â”‚
â”‚  ãƒã‚§ãƒƒã‚¯çµæœ: ğŸ”´ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ¨å¥¨  ğŸŸ¡ èª¿æŸ»æ¨å¥¨  ğŸŸ¢ å•é¡Œãªã—           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 5ã‚«ãƒ†ã‚´ãƒªã®è©³ç´°

| ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ | ä»£è¡¨çš„ãªãƒã‚§ãƒƒã‚¯é …ç›® |
|---------|------|-------------------|
| **ã‚³ã‚¹ãƒˆæœ€é©åŒ–** | ç„¡é§„ãªã‚³ã‚¹ãƒˆã®å‰Šæ¸› | æœªä½¿ç”¨EIPã€ä½ä½¿ç”¨ç‡EC2ã€ã‚¢ã‚¤ãƒ‰ãƒ«RDSã€ã‚¢ã‚¤ãƒ‰ãƒ«LB |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** | ãƒªã‚½ãƒ¼ã‚¹ã®æœ€é©åŒ– | EC2éå‰°åˆ©ç”¨ã€CloudFrontè¨­å®šã€EBS IOPSæœ€é©åŒ– |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®æ”¹å–„ | SGã®ç„¡åˆ¶é™ã‚¢ã‚¯ã‚»ã‚¹ã€IAMã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã€MFAç„¡åŠ¹ã€S3ãƒ‘ãƒ–ãƒªãƒƒã‚¯ |
| **è€éšœå®³æ€§** | å†—é•·æ€§ãƒ»å›å¾©åŠ›ã®æ”¹å–„ | EBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã€RDSãƒãƒ«ãƒAZã€ASGã®AZåˆ†æ•£ |
| **ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™** | ã‚¯ã‚©ãƒ¼ã‚¿åˆ°é”ã®è­¦å‘Š | VPCæ•°ã€EIPæ•°ã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ï¼ˆ80%è¶…ã§è­¦å‘Šï¼‰ |

### 1.3 DOPè©¦é¨“ã§ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

| ãƒˆãƒ”ãƒƒã‚¯ | é‡è¦åº¦ | å‡ºé¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ |
|---------|--------|-------------|
| **ã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³åˆ¥ã®ãƒã‚§ãƒƒã‚¯** | â˜…â˜…â˜…â˜…â˜… | ã©ã®ãƒ—ãƒ©ãƒ³ã§ä½•ãŒä½¿ãˆã‚‹ã‹ |
| **EventBridgeé€£æº** | â˜…â˜…â˜…â˜…â˜… | è‡ªå‹•å¿œç­”ã®è¨­è¨ˆ |
| **Organizationsçµ±åˆ** | â˜…â˜…â˜…â˜…â˜† | çµ„ç¹”å…¨ä½“ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ |
| **Trusted Advisor API** | â˜…â˜…â˜…â˜…â˜† | ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªã‚¢ã‚¯ã‚»ã‚¹ |
| **ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥é–“éš”** | â˜…â˜…â˜…â˜†â˜† | ãƒ‡ãƒ¼ã‚¿ã®é®®åº¦ã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯** | â˜…â˜…â˜…â˜…â˜… | é »å‡º: SGã®0.0.0.0/0 |

### 1.4 ãƒã‚§ãƒƒã‚¯çµæœã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

```
ã€Trusted Advisor ãƒã‚§ãƒƒã‚¯çµæœã®èª­ã¿æ–¹ã€‘

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹         â”‚  æ„å‘³                 â”‚ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”´ Red (Error)     â”‚ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ¨å¥¨        â”‚ å³æ™‚å¯¾å¿œ   â”‚
â”‚  ğŸŸ¡ Yellow (Warning)â”‚ èª¿æŸ»æ¨å¥¨              â”‚ è¨ˆç”»çš„å¯¾å¿œ â”‚
â”‚  ğŸŸ¢ Green (OK)      â”‚ å•é¡Œãªã—              â”‚ ä¸è¦       â”‚
â”‚  ğŸ”µ Blue (Excluded) â”‚ ãƒã‚§ãƒƒã‚¯ã‹ã‚‰é™¤å¤–æ¸ˆã¿  â”‚ ä¸è¦       â”‚
â”‚  â¬œ Gray (Refresh)  â”‚ ãƒ‡ãƒ¼ã‚¿æ›´æ–°ä¸­          â”‚ å¾…æ©Ÿ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥:
â”œâ”€ è‡ªå‹•: æ¯é€±ï¼ˆBusiness/Enterprise ã‚µãƒãƒ¼ãƒˆï¼‰
â”œâ”€ æ‰‹å‹•: ã‚³ãƒ³ã‚½ãƒ¼ãƒ« or APIï¼ˆæœ€çŸ­5åˆ†é–“éš”ï¼‰
â””â”€ API: aws support refresh-trusted-advisor-check
```

---

## 2. ã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³åˆ¥ã®åˆ©ç”¨å¯èƒ½ãƒã‚§ãƒƒã‚¯

### 2.1 ãƒ—ãƒ©ãƒ³åˆ¥æ¯”è¼ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³åˆ¥ Trusted Advisor                       â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Basic / Developer   â”‚     â”‚ Business / Enterprise â”‚              â”‚
â”‚  â”‚                      â”‚     â”‚                      â”‚              â”‚
â”‚  â”‚  â–  ã‚³ã‚¢ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ â”‚     â”‚ â–  å…¨ãƒã‚§ãƒƒã‚¯é …ç›®     â”‚              â”‚
â”‚  â”‚    ãƒã‚§ãƒƒã‚¯ã®ã¿       â”‚     â”‚  (100+ ãƒã‚§ãƒƒã‚¯)     â”‚              â”‚
â”‚  â”‚                      â”‚     â”‚                      â”‚              â”‚
â”‚  â”‚  ãƒ»S3ãƒ‘ãƒ–ãƒªãƒƒã‚¯       â”‚     â”‚ â–  API ã‚¢ã‚¯ã‚»ã‚¹       â”‚              â”‚
â”‚  â”‚  ãƒ»SG ç„¡åˆ¶é™ãƒãƒ¼ãƒˆ   â”‚     â”‚                      â”‚              â”‚
â”‚  â”‚  ãƒ»IAM ä½¿ç”¨çŠ¶æ³      â”‚     â”‚ â–  CloudWatché€£æº     â”‚              â”‚
â”‚  â”‚  ãƒ»MFA (ãƒ«ãƒ¼ãƒˆ)      â”‚     â”‚                      â”‚              â”‚
â”‚  â”‚  ãƒ»EBS ãƒ‘ãƒ–ãƒªãƒƒã‚¯    â”‚     â”‚ â–  EventBridgeé€£æº    â”‚              â”‚
â”‚  â”‚  ãƒ»RDS ãƒ‘ãƒ–ãƒªãƒƒã‚¯    â”‚     â”‚                      â”‚              â”‚
â”‚  â”‚  ãƒ»ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™      â”‚     â”‚ â–  ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ â”‚              â”‚
â”‚  â”‚                      â”‚     â”‚   ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥       â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ—ãƒ©ãƒ³åˆ¥ãƒã‚§ãƒƒã‚¯ä¸€è¦§

| ãƒã‚§ãƒƒã‚¯é …ç›® | Basic/Developer | Business/Enterprise |
|-------------|:---------------:|:-------------------:|
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: SGã®ç„¡åˆ¶é™ã‚¢ã‚¯ã‚»ã‚¹** | â—‹ | â—‹ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: S3ãƒã‚±ãƒƒãƒˆãƒ‘ãƒ–ãƒªãƒƒã‚¯** | â—‹ | â—‹ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ãƒ«ãƒ¼ãƒˆMFA** | â—‹ | â—‹ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: IAMä½¿ç”¨çŠ¶æ³** | â—‹ | â—‹ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: EBSãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ** | â—‹ | â—‹ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: RDSãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ** | â—‹ | â—‹ |
| **ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™** | â—‹ | â—‹ |
| ã‚³ã‚¹ãƒˆ: ä½ä½¿ç”¨ç‡EC2 | Ã— | â—‹ |
| ã‚³ã‚¹ãƒˆ: ã‚¢ã‚¤ãƒ‰ãƒ«RDS | Ã— | â—‹ |
| ã‚³ã‚¹ãƒˆ: æœªé–¢é€£ä»˜ã‘EIP | Ã— | â—‹ |
| ã‚³ã‚¹ãƒˆ: ã‚¢ã‚¤ãƒ‰ãƒ«LB | Ã— | â—‹ |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: EC2é«˜ä½¿ç”¨ç‡ | Ã— | â—‹ |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: CloudFrontæœ€é©åŒ– | Ã— | â—‹ |
| è€éšœå®³æ€§: RDSãƒãƒ«ãƒAZ | Ã— | â—‹ |
| è€éšœå®³æ€§: EBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ | Ã— | â—‹ |
| è€éšœå®³æ€§: ASGãƒãƒ«ãƒAZ | Ã— | â—‹ |
| **API/ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹** | Ã— | â—‹ |
| **EventBridgeé€£æº** | Ã— | â—‹ |

### 2.3 CLIã§ã®ãƒã‚§ãƒƒã‚¯ç¢ºèª

```bash
# â€» Business/Enterpriseã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³å¿…é ˆ

# Trusted Advisorã®ãƒã‚§ãƒƒã‚¯ä¸€è¦§å–å¾—
aws support describe-trusted-advisor-checks \
  --language ja \
  --query "checks[].{id:id,name:name,category:category}" \
  --output table

# ç‰¹å®šã‚«ãƒ†ã‚´ãƒªã®ãƒã‚§ãƒƒã‚¯ä¸€è¦§
aws support describe-trusted-advisor-checks \
  --language ja \
  --query "checks[?category=='security'].{id:id,name:name}" \
  --output table

# ãƒã‚§ãƒƒã‚¯çµæœã®ã‚µãƒãƒªãƒ¼å–å¾—
aws support describe-trusted-advisor-check-summaries \
  --check-ids "Pfx0RwqBli" \
  --query "summaries[].{status:status,flagged:resourcesSummary.resourcesFlagged}"

# ãƒã‚§ãƒƒã‚¯çµæœã®è©³ç´°å–å¾—
aws support describe-trusted-advisor-check-result \
  --check-id "Pfx0RwqBli" \
  --query "result.{status:status,resources:flaggedResources[].metadata}"

# ãƒã‚§ãƒƒã‚¯ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆæœ€çŸ­5åˆ†é–“éš”ï¼‰
aws support refresh-trusted-advisor-check \
  --check-id "Pfx0RwqBli"
```

### 2.4 é‡è¦ãªãƒã‚§ãƒƒã‚¯IDã®ä¾‹

| ãƒã‚§ãƒƒã‚¯ | ãƒã‚§ãƒƒã‚¯ID | ã‚«ãƒ†ã‚´ãƒª |
|---------|-----------|---------|
| SGã®ç„¡åˆ¶é™ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆç‰¹å®šãƒãƒ¼ãƒˆï¼‰ | HCP4007jGY | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ |
| S3ãƒã‚±ãƒƒãƒˆãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ | Pfx0RwqBli | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ |
| IAMã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ | DqdJqYeRm5 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ |
| ä½ä½¿ç”¨ç‡EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ | Qch7DwouX1 | ã‚³ã‚¹ãƒˆæœ€é©åŒ– |
| RDSã‚¢ã‚¤ãƒ‰ãƒ«DB | Ti39halfu8 | ã‚³ã‚¹ãƒˆæœ€é©åŒ– |
| EBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ | H7IgTzjTYb | è€éšœå®³æ€§ |

---

## 3. Trusted Advisor + EventBridgeé€£æº

### 3.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Trusted Advisor + EventBridge è‡ªå‹•å¿œç­”ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£        â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Trusted    â”‚      â”‚  Amazon      â”‚      â”‚   Lambda     â”‚       â”‚
â”‚  â”‚   Advisor    â”‚â”€â”€â”€â”€â”€â–¶â”‚  EventBridge â”‚â”€â”€â”€â”€â”€â–¶â”‚   Function   â”‚       â”‚
â”‚  â”‚              â”‚      â”‚              â”‚      â”‚              â”‚       â”‚
â”‚  â”‚  ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ â”‚      â”‚  ãƒ«ãƒ¼ãƒ«:     â”‚      â”‚  è‡ªå‹•ä¿®å¾©:   â”‚       â”‚
â”‚  â”‚  çµæœå¤‰æ›´    â”‚      â”‚  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹  â”‚      â”‚  SGä¿®æ­£     â”‚       â”‚
â”‚  â”‚              â”‚      â”‚  å¤‰æ›´æ¤œçŸ¥    â”‚      â”‚  é€šçŸ¥é€ä¿¡    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                       â”‚               â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                         â”‚                            â–¼      â”‚       â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚                         â”‚  â”‚     SNS      â”‚  â”‚    EC2     â”‚â”‚       â”‚
â”‚                         â”‚  â”‚  é€šçŸ¥é€ä¿¡    â”‚  â”‚  SGä¿®æ­£    â”‚â”‚       â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚                         â”‚  â”‚   Systems    â”‚  â”‚  AWS Config â”‚â”‚       â”‚
â”‚                         â”‚  â”‚   Manager    â”‚  â”‚  ä¿®å¾©ãƒ«ãƒ¼ãƒ« â”‚â”‚       â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é‡è¦: Trusted Advisorã®ã‚¤ãƒ™ãƒ³ãƒˆã¯US East (N. Virginia)ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã¿
```

### 3.2 EventBridgeãƒ«ãƒ¼ãƒ«ã®è¨­å®š

```bash
# â€» us-east-1 ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆé‡è¦ï¼ï¼‰

# EventBridgeãƒ«ãƒ¼ãƒ«: Trusted Advisorã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
aws events put-rule \
  --region us-east-1 \
  --name "trusted-advisor-security-alert" \
  --event-pattern '{
    "source": ["aws.trustedadvisor"],
    "detail-type": ["Trusted Advisor Check Item Refresh Notification"],
    "detail": {
      "check-name": ["Security Groups - Unrestricted Access"],
      "status": ["WARN", "ERROR"]
    }
  }' \
  --state ENABLED \
  --description "Trusted Advisor ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—è­¦å‘Š"

# SNSãƒˆãƒ”ãƒƒã‚¯ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«è¨­å®š
aws events put-targets \
  --region us-east-1 \
  --rule "trusted-advisor-security-alert" \
  --targets '[{
    "Id": "sns-notification",
    "Arn": "arn:aws:sns:us-east-1:123456789012:security-alerts"
  }]'
```

### 3.3 EventBridgeã‚¤ãƒ™ãƒ³ãƒˆã®æ§‹é€ 

```json
{
  "version": "0",
  "id": "12345678-1234-1234-1234-123456789012",
  "detail-type": "Trusted Advisor Check Item Refresh Notification",
  "source": "aws.trustedadvisor",
  "account": "123456789012",
  "time": "2026-02-04T10:00:00Z",
  "region": "us-east-1",
  "detail": {
    "check-name": "Security Groups - Unrestricted Access",
    "check-item-detail": {
      "Status": "Red",
      "Region": "ap-northeast-1",
      "Security Group ID": "sg-12345678",
      "Security Group Name": "web-server-sg",
      "Port": "22",
      "Protocol": "tcp",
      "IP Range": "0.0.0.0/0"
    },
    "status": "ERROR",
    "resource_id": "sg-12345678"
  }
}
```

### 3.4 è‡ªå‹•ä¿®å¾©Lambdaé–¢æ•°ã®ä¾‹

```python
# trusted_advisor_remediation.py
import boto3
import json

def lambda_handler(event, context):
    """
    Trusted Advisor + EventBridge ã‹ã‚‰ã®
    ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—é•åã‚’è‡ªå‹•ä¿®å¾©
    """
    detail = event['detail']
    check_detail = detail['check-item-detail']

    sg_id = check_detail['Security Group ID']
    port = int(check_detail['Port'])
    protocol = check_detail['Protocol']
    region = check_detail['Region']

    ec2 = boto3.client('ec2', region_name=region)
    sns = boto3.client('sns', region_name='us-east-1')

    # 0.0.0.0/0 ã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’å‰Šé™¤
    try:
        ec2.revoke_security_group_ingress(
            GroupId=sg_id,
            IpPermissions=[{
                'IpProtocol': protocol,
                'FromPort': port,
                'ToPort': port,
                'IpRanges': [{'CidrIp': '0.0.0.0/0'}]
            }]
        )
        message = f"è‡ªå‹•ä¿®å¾©å®Œäº†: {sg_id} ã®ãƒãƒ¼ãƒˆ {port} ã‹ã‚‰ 0.0.0.0/0 ã‚’å‰Šé™¤"
    except Exception as e:
        message = f"è‡ªå‹•ä¿®å¾©å¤±æ•—: {sg_id} - {str(e)}"

    # SNSé€šçŸ¥
    sns.publish(
        TopicArn='arn:aws:sns:us-east-1:123456789012:security-alerts',
        Subject='Trusted Advisor è‡ªå‹•ä¿®å¾©é€šçŸ¥',
        Message=message
    )

    return {'statusCode': 200, 'body': message}
```

### 3.5 ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™ã®EventBridgeé€£æº

```bash
# ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™ãƒã‚§ãƒƒã‚¯ã®EventBridgeãƒ«ãƒ¼ãƒ«
aws events put-rule \
  --region us-east-1 \
  --name "trusted-advisor-service-limit" \
  --event-pattern '{
    "source": ["aws.trustedadvisor"],
    "detail-type": ["Trusted Advisor Check Item Refresh Notification"],
    "detail": {
      "status": ["WARN", "ERROR"],
      "check-name": [
        {"prefix": "Service Limits"}
      ]
    }
  }' \
  --state ENABLED

# Lambda ã§ã‚¯ã‚©ãƒ¼ã‚¿å¢—åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è‡ªå‹•åŒ–
# â†’ Service Quotas API ã¨é€£æº
```

---

## 4. Organizationå˜ä½ã®Trusted Advisor

### 4.1 çµ„ç¹”ãƒ“ãƒ¥ãƒ¼ã®æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AWS Organizations + Trusted Advisor çµ„ç¹”ãƒ“ãƒ¥ãƒ¼               â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚   Management Account     â”‚                                      â”‚
â”‚  â”‚                          â”‚                                      â”‚
â”‚  â”‚  Trusted Advisor         â”‚                                      â”‚
â”‚  â”‚  Organizational View     â”‚â—€â”€â”€â”€â”€ çµ„ç¹”å…¨ä½“ã®ãƒã‚§ãƒƒã‚¯çµæœã‚’é›†ç´„    â”‚
â”‚  â”‚                          â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚             â”‚                                                        â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚      â”‚              â”‚                       â”‚                        â”‚
â”‚      â–¼              â–¼                       â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚OU: Prod â”‚  â”‚OU: Dev      â”‚  â”‚OU: Security  â”‚                   â”‚
â”‚  â”‚         â”‚  â”‚             â”‚  â”‚              â”‚                   â”‚
â”‚  â”‚ Acct-A  â”‚  â”‚ Acct-C      â”‚  â”‚ Acct-E       â”‚                   â”‚
â”‚  â”‚ Acct-B  â”‚  â”‚ Acct-D      â”‚  â”‚              â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›                               â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚     S3       â”‚     â”‚  QuickSight  â”‚     â”‚    Athena    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  JSON/CSV    â”‚â”€â”€â”€â”€â–¶â”‚  ãƒ€ãƒƒã‚·ãƒ¥    â”‚     â”‚  ã‚¯ã‚¨ãƒªåˆ†æ  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ãƒ¬ãƒãƒ¼ãƒˆ    â”‚     â”‚  ãƒœãƒ¼ãƒ‰      â”‚     â”‚              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 çµ„ç¹”ãƒ“ãƒ¥ãƒ¼ã®æœ‰åŠ¹åŒ–ã¨ç®¡ç†

```bash
# çµ„ç¹”ãƒ“ãƒ¥ãƒ¼ã®æœ‰åŠ¹åŒ–ï¼ˆManagement Accountã§å®Ÿè¡Œï¼‰
aws trustedadvisor set-organization-access \
  --region us-east-1 \
  --status ENABLED

# çµ„ç¹”ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆ
aws trustedadvisor create-organization-report \
  --region us-east-1 \
  --format JSON

# ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª
aws trustedadvisor describe-organization-reports \
  --region us-east-1

# ãƒ¬ãƒãƒ¼ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆS3ã‹ã‚‰å–å¾—ï¼‰
aws s3 cp s3://trusted-advisor-org-report-ACCOUNT_ID/report.json ./
```

### 4.3 çµ„ç¹”å…¨ä½“ã®ãƒã‚§ãƒƒã‚¯çµæœã‚’Athenaã§åˆ†æ

```sql
-- Athena ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆS3ã®ãƒ¬ãƒãƒ¼ãƒˆã«å¯¾ã—ã¦ï¼‰
CREATE EXTERNAL TABLE trusted_advisor_org_report (
  account_id STRING,
  check_name STRING,
  category STRING,
  status STRING,
  region STRING,
  resource_id STRING,
  timestamp STRING
)
ROW FORMAT SERDE 'org.openx.data.jsonserde.JsonSerDe'
LOCATION 's3://trusted-advisor-org-reports/';

-- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®å•é¡Œæ•°é›†è¨ˆ
SELECT
  category,
  status,
  COUNT(*) as count
FROM trusted_advisor_org_report
WHERE status IN ('WARN', 'ERROR')
GROUP BY category, status
ORDER BY count DESC;

-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ
SELECT
  account_id,
  check_name,
  COUNT(*) as flagged_count
FROM trusted_advisor_org_report
WHERE category = 'security' AND status = 'ERROR'
GROUP BY account_id, check_name
ORDER BY flagged_count DESC;
```

### 4.4 AWS Trusted Advisor Priority (Enterprise ã‚µãƒãƒ¼ãƒˆ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Trusted Advisor Priority                               â”‚
â”‚              (Enterprise ã‚µãƒãƒ¼ãƒˆé™å®š)                              â”‚
â”‚                                                                    â”‚
â”‚  ç‰¹å¾´:                                                             â”‚
â”‚  â”œâ”€ AWSãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£(TAM)ãŒå„ªå…ˆé †ä½ä»˜ã‘          â”‚
â”‚  â”œâ”€ çµ„ç¹”å…¨ä½“ã®ãƒªã‚¹ã‚¯ã‚’å„ªå…ˆåº¦é †ã«è¡¨ç¤º                              â”‚
â”‚  â”œâ”€ AWS Health ã¨çµ±åˆ                                             â”‚
â”‚  â””â”€ APIã§ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹å¯¾å¿œ                         â”‚
â”‚                                                                    â”‚
â”‚  å„ªå…ˆåº¦ãƒ¬ãƒ™ãƒ«:                                                     â”‚
â”‚  â”œâ”€ Critical: å³æ™‚å¯¾å¿œãŒå¿…è¦                                      â”‚
â”‚  â”œâ”€ Warning: è¨ˆç”»çš„å¯¾å¿œãŒå¿…è¦                                     â”‚
â”‚  â””â”€ Informational: å‚è€ƒæƒ…å ±                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# Part 2 - AWS Elastic Beanstalk

---

## 5. Beanstalkæ¦‚è¦

### 5.1 Elastic Beanstalkã¨ã¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AWS Elastic Beanstalk                              â”‚
â”‚           ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç°¡æ˜“ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹                 â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   é–‹ç™ºè€…ãŒç”¨æ„ã™ã‚‹ã‚‚ã®                            â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³â”‚  â”‚   è¨­å®š       â”‚  â”‚   æ‹¡å¼µè¨­å®š   â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  ã‚³ãƒ¼ãƒ‰       â”‚  â”‚ (ç’°å¢ƒå¤‰æ•°)   â”‚  â”‚(.ebextensions)â”‚         â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                        â”‚
â”‚                              â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               BeanstalkãŒè‡ªå‹•ä½œæˆãƒ»ç®¡ç†ã™ã‚‹ã‚‚ã®                  â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚ EC2 â”‚  â”‚ ASG â”‚  â”‚ ELB â”‚  â”‚ SG  â”‚  â”‚ CW  â”‚  â”‚ S3   â”‚     â”‚ â”‚
â”‚  â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚Logs â”‚  â”‚Bucketâ”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  â€» ã‚¤ãƒ³ãƒ•ãƒ©ã®å®Œå…¨ãªåˆ¶å¾¡æ¨©ã¯é–‹ç™ºè€…ã«æ®‹ã‚‹                         â”‚ â”‚
â”‚  â”‚  â€» CloudFormationã‚¹ã‚¿ãƒƒã‚¯ã¨ã—ã¦ç®¡ç†ã•ã‚Œã‚‹                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```
ã€Beanstalk ã®3å¤§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‘

1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Application)
   â””â”€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ
      â”‚
      â”œâ”€â”€ 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ (Application Version)
      â”‚   â”œâ”€â”€ v1.0.0 â†’ S3ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ãƒãƒ³ãƒ‰ãƒ«
      â”‚   â”œâ”€â”€ v1.1.0 â†’ S3ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ãƒãƒ³ãƒ‰ãƒ«
      â”‚   â””â”€â”€ v2.0.0 â†’ S3ã«ä¿å­˜ã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ãƒãƒ³ãƒ‰ãƒ«
      â”‚
      â””â”€â”€ 3. ç’°å¢ƒ (Environment)
          â”œâ”€â”€ Productionç’°å¢ƒ (Web Serverå‹)
          â”‚   â”œâ”€ ELB + ASG + EC2
          â”‚   â””â”€ ç¾åœ¨: v1.1.0
          â”‚
          â”œâ”€â”€ Stagingç’°å¢ƒ (Web Serverå‹)
          â”‚   â”œâ”€ ELB + ASG + EC2
          â”‚   â””â”€ ç¾åœ¨: v2.0.0
          â”‚
          â””â”€â”€ Workerç’°å¢ƒ (Workerå‹)
              â”œâ”€ SQS + ASG + EC2
              â””â”€ ç¾åœ¨: v1.1.0

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«:
â”œâ”€ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: æœ€å¤§1000ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¿æŒ
â”œâ”€ ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼: å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®è‡ªå‹•å‰Šé™¤
â”‚   â”œâ”€ ç·æ•°ãƒ™ãƒ¼ã‚¹: Nå€‹ã‚’è¶…ãˆãŸã‚‰å‰Šé™¤
â”‚   â””â”€ æœŸé–“ãƒ™ãƒ¼ã‚¹: Næ—¥çµŒéã§å‰Šé™¤
â””â”€ S3ã‚½ãƒ¼ã‚¹ãƒãƒ³ãƒ‰ãƒ«ã®å‰Šé™¤ã‚‚é¸æŠå¯èƒ½
```

### 5.3 ç’°å¢ƒã‚¿ã‚¤ãƒ—

| é …ç›® | Web Serverç’°å¢ƒ | Workerç’°å¢ƒ |
|------|--------------|-----------|
| **ç”¨é€”** | HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç† | ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç† |
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | ELB (ALB/NLB/CLB) | ãªã— |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** | EC2 (ASG) | EC2 (ASG) |
| **å…¥åŠ›** | HTTP/HTTPS | SQS ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| **ãƒ‡ãƒ¼ãƒ¢ãƒ³** | ãªã— | SQSãƒ‡ãƒ¼ãƒ¢ãƒ³ (sqsd) |
| **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãƒ™ãƒ¼ã‚¹ | ã‚­ãƒ¥ãƒ¼æ·±åº¦ãƒ™ãƒ¼ã‚¹ |

### 5.4 å¯¾å¿œãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

| ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¾‹ | å‚™è€ƒ |
|----------------|-------------|------|
| **Node.js** | Node.js 20 on AL2023 | npm/yarnå¯¾å¿œ |
| **Python** | Python 3.12 on AL2023 | pip/pipenvå¯¾å¿œ |
| **Java SE** | Corretto 21 on AL2023 | JARå®Ÿè¡Œ |
| **Tomcat** | Tomcat 10 on AL2023 | WAR ãƒ‡ãƒ—ãƒ­ã‚¤ |
| **.NET on Linux** | .NET 8 on AL2023 | ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  |
| **Go** | Go 1.21 on AL2023 | ãƒã‚¤ãƒŠãƒªå®Ÿè¡Œ |
| **Ruby** | Ruby 3.2 on AL2023 | Puma/Passenger |
| **PHP** | PHP 8.3 on AL2023 | Composerå¯¾å¿œ |
| **Docker** | Docker on AL2023 | å˜ä¸€/ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠ |
| **Custom Platform** | Packer ã§ä½œæˆ | ç‹¬è‡ªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  |

---

## 6. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼

### 6.1 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼æ¯”è¼ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Beanstalk ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼æ¯”è¼ƒ                      â”‚
â”‚                                                                      â”‚
â”‚  â–  = æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³    â–¡ = æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³    Ã— = åœæ­¢ä¸­                â”‚
â”‚                                                                      â”‚
â”‚  1. All at once (å…¨ã¦ä¸€æ‹¬)                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚ â–  â–  â–  â–          â”‚â”€â”€â”€â”€â–¶â”‚ â–¡ â–¡ â–¡ â–¡         â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚     â€» ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚ã‚Šã€æœ€é€Ÿ                                       â”‚
â”‚                                                                      â”‚
â”‚  2. Rolling (ãƒ­ãƒ¼ãƒªãƒ³ã‚°)                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ â–  â–  â–  â–          â”‚â”€â”€â”€â”€â–¶â”‚ â–¡ â–¡ â–  â–          â”‚â”€â”€â”€â”€â–¶â”‚ â–¡ â–¡ â–¡ â–¡   â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â€» ãƒãƒƒãƒã‚µã‚¤ã‚ºåˆ†ãšã¤æ›´æ–°ã€ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£æ¸›å°‘ã‚ã‚Š                 â”‚
â”‚                                                                      â”‚
â”‚  3. Rolling with additional batch (è¿½åŠ ãƒãƒƒãƒä»˜ã)                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ â–  â–  â–  â–          â”‚â”€â”€â”€â”€â–¶â”‚ â–¡ â–¡ â–  â–  + â–¡ â–¡    â”‚â”€â”€â–¶â”‚ â–¡ â–¡ â–¡ â–¡   â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â€» æ–°ãƒãƒƒãƒè¿½åŠ å¾Œã«æ—§ãƒãƒƒãƒæ›´æ–°ã€ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ç¶­æŒ              â”‚
â”‚                                                                      â”‚
â”‚  4. Immutable (ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«)                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ â–  â–  â–  â–          â”‚â”€â”€â”€â”€â–¶â”‚ â–  â–  â–  â–  â”‚ â–¡ â–¡ â–¡ â–¡â”‚â”€â”€â–¶â”‚ â–¡ â–¡ â–¡ â–¡   â”‚â”‚
â”‚     â”‚    ASG-1         â”‚     â”‚  ASG-1   â”‚ ASG-2  â”‚   â”‚  ASG-1    â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â€» æ–°ASGã§å®Œå…¨ã«æ–°ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã€æˆåŠŸå¾Œã«æ—§ã‚’å‰Šé™¤              â”‚
â”‚                                                                      â”‚
â”‚  5. Traffic splitting (ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ†å‰²)                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ â–  â–  â–  â–          â”‚â”€â”€â”€â”€â–¶â”‚ â–  â–  â–  â–  â”‚ â–¡ â–¡ â–¡ â–¡â”‚â”€â”€â–¶â”‚ â–¡ â–¡ â–¡ â–¡   â”‚â”‚
â”‚     â”‚  100% traffic    â”‚     â”‚ 90%      â”‚ 10%    â”‚   â”‚  100%     â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â€» ALBã§æ®µéšçš„ã«ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç§»è¡Œï¼ˆã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰          â”‚
â”‚                                                                      â”‚
â”‚  6. Blue/Green (CNAME swap)                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ Env-Blue â”‚  â”‚Env-Green â”‚â”€â”€â”€â”€â–¶â”‚ Env-Blue â”‚  â”‚Env-Green â”‚  â”‚
â”‚     â”‚ â–  â–  â–  â–  â”‚  â”‚ â–¡ â–¡ â–¡ â–¡ â”‚     â”‚ â–  â–  â–  â–  â”‚  â”‚ â–¡ â–¡ â–¡ â–¡ â”‚  â”‚
â”‚     â”‚prod.app  â”‚  â”‚stg.app   â”‚     â”‚stg.app   â”‚  â”‚prod.app  â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â€» CNAMEäº¤æ›ã€å®Œå…¨ã«ç‹¬ç«‹ã—ãŸç’°å¢ƒã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®¹æ˜“              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼è©³ç´°æ¯”è¼ƒè¡¨

| ãƒãƒªã‚·ãƒ¼ | ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  | ãƒ‡ãƒ—ãƒ­ã‚¤é€Ÿåº¦ | ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ | ã‚³ã‚¹ãƒˆ | DNSå¤‰æ›´ |
|---------|:----------:|:----------:|:----------:|:----------:|:-----:|:-------:|
| **All at once** | ã‚ã‚Š | æœ€é€Ÿ | å†ãƒ‡ãƒ—ãƒ­ã‚¤ | æ¸›å°‘ | æœ€ä½ | ãªã— |
| **Rolling** | ãªã— | ä¸­ | å†ãƒ‡ãƒ—ãƒ­ã‚¤ | ä¸€æ™‚æ¸›å°‘ | ä½ | ãªã— |
| **Rolling w/ batch** | ãªã— | ä¸­ã€œä½ | å†ãƒ‡ãƒ—ãƒ­ã‚¤ | ç¶­æŒ | ä¸­ | ãªã— |
| **Immutable** | ãªã— | ä½ | æ–°ASGå‰Šé™¤ | å€å¢— | é«˜ | ãªã— |
| **Traffic splitting** | ãªã— | ä½ | æ–°ASGå‰Šé™¤ | å€å¢— | é«˜ | ãªã— |
| **Blue/Green** | æœ€å° | ä½ | CNAME swap | å€å¢— | æœ€é«˜ | ã‚ã‚Š |

### 6.3 ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã®CLIæ“ä½œ

```bash
# ç¾åœ¨ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šç¢ºèª
aws elasticbeanstalk describe-configuration-settings \
  --application-name my-app \
  --environment-name my-env \
  --query "ConfigurationSettings[0].OptionSettings[?Namespace=='aws:elasticbeanstalk:command']"

# All at once
aws elasticbeanstalk update-environment \
  --environment-name my-env \
  --option-settings \
    Namespace=aws:elasticbeanstalk:command,OptionName=DeploymentPolicy,Value=AllAtOnce

# Rollingï¼ˆãƒãƒƒãƒã‚µã‚¤ã‚º: 25%ï¼‰
aws elasticbeanstalk update-environment \
  --environment-name my-env \
  --option-settings \
    Namespace=aws:elasticbeanstalk:command,OptionName=DeploymentPolicy,Value=Rolling \
    Namespace=aws:elasticbeanstalk:command,OptionName=BatchSizeType,Value=Percentage \
    Namespace=aws:elasticbeanstalk:command,OptionName=BatchSize,Value=25

# Rolling with additional batch
aws elasticbeanstalk update-environment \
  --environment-name my-env \
  --option-settings \
    Namespace=aws:elasticbeanstalk:command,OptionName=DeploymentPolicy,Value=RollingWithAdditionalBatch \
    Namespace=aws:elasticbeanstalk:command,OptionName=BatchSizeType,Value=Fixed \
    Namespace=aws:elasticbeanstalk:command,OptionName=BatchSize,Value=2

# Immutable
aws elasticbeanstalk update-environment \
  --environment-name my-env \
  --option-settings \
    Namespace=aws:elasticbeanstalk:command,OptionName=DeploymentPolicy,Value=Immutable

# Traffic splittingï¼ˆ10%ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã§10åˆ†é–“è©•ä¾¡ï¼‰
aws elasticbeanstalk update-environment \
  --environment-name my-env \
  --option-settings \
    Namespace=aws:elasticbeanstalk:command,OptionName=DeploymentPolicy,Value=TrafficSplitting \
    Namespace=aws:elasticbeanstalk:trafficsplitting,OptionName=NewVersionPercent,Value=10 \
    Namespace=aws:elasticbeanstalk:trafficsplitting,OptionName=EvaluationTime,Value=10
```

### 6.4 Blue/Greenãƒ‡ãƒ—ãƒ­ã‚¤ã®å®Ÿè¡Œ

```bash
# Blue/Green ã¯ Beanstalk ã®çµ„ã¿è¾¼ã¿æ©Ÿèƒ½ã§ã¯ãªãã€
# ç’°å¢ƒã® CNAME swap ã§å®Ÿç¾ã™ã‚‹

# 1. ç¾åœ¨ã®æœ¬ç•ªç’°å¢ƒã‚’ç¢ºèª
aws elasticbeanstalk describe-environments \
  --environment-names prod-env \
  --query "Environments[0].{CNAME:CNAME,Status:Status,Version:VersionLabel}"

# 2. Greenç’°å¢ƒã‚’æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä½œæˆ
aws elasticbeanstalk create-environment \
  --application-name my-app \
  --environment-name green-env \
  --solution-stack-name "64bit Amazon Linux 2023 v6.1.0 running Node.js 20" \
  --version-label v2.0.0 \
  --option-settings file://env-options.json

# 3. Greenç’°å¢ƒã®æ­£å¸¸æ€§ç¢ºèª
aws elasticbeanstalk describe-environments \
  --environment-names green-env \
  --query "Environments[0].{Health:Health,Status:Status}"

# 4. CNAME swap å®Ÿè¡Œ
aws elasticbeanstalk swap-environment-cnames \
  --source-environment-name prod-env \
  --destination-environment-name green-env

# 5. swapå¾Œã®ç¢ºèª
aws elasticbeanstalk describe-environments \
  --environment-names prod-env green-env \
  --query "Environments[].{Name:EnvironmentName,CNAME:CNAME}"

# 6. å•é¡ŒãŒãªã‘ã‚Œã°æ—§ç’°å¢ƒã‚’å‰Šé™¤
aws elasticbeanstalk terminate-environment \
  --environment-name prod-env

# ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚‚ã†ä¸€åº¦ swap-environment-cnames ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘
```

### 6.5 Blue/Greenæ™‚ã®DNSæ³¨æ„ç‚¹

```
ã€Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤ã® DNS æ³¨æ„äº‹é …ã€‘

CNAME swap ã®å ´åˆ:
â”œâ”€ Beanstalk URL (xxx.elasticbeanstalk.com) ãŒå…¥ã‚Œæ›¿ã‚ã‚‹
â”œâ”€ ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã§ CNAME ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯é€éçš„
â”œâ”€ Route 53 Alias ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å ´åˆã¯æ‰‹å‹•æ›´æ–°ãŒå¿…è¦
â””â”€ DNS TTL ã«æ³¨æ„ï¼ˆä¼æ’­æ™‚é–“ã‚ã‚Šï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  swapå‰:                                          â”‚
â”‚  prod-env.elasticbeanstalk.com â†’ Blue (v1)       â”‚
â”‚  green-env.elasticbeanstalk.com â†’ Green (v2)     â”‚
â”‚                                                   â”‚
â”‚  swapå¾Œ:                                          â”‚
â”‚  prod-env.elasticbeanstalk.com â†’ Green (v2) â˜…   â”‚
â”‚  green-env.elasticbeanstalk.com â†’ Blue (v1)      â”‚
â”‚                                                   â”‚
â”‚  â€» CNAMEãƒ¬ãƒ™ãƒ«ã®äº¤æ›ã§ã‚ã‚Šã€ELBè‡ªä½“ã¯å¤‰ã‚ã‚‰ãªã„ â”‚
â”‚  â€» RDSç­‰ã®å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã¯å…±æœ‰ã•ã‚Œã‚‹è¨­è¨ˆãŒå¿…è¦     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. .ebextensions ã¨ Platform Hooks

### 7.1 .ebextensionsã®æ¦‚è¦

```
ã€.ebextensions ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã€‘

my-app/
â”œâ”€â”€ app.js                      â† ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ package.json
â”œâ”€â”€ .ebextensions/              â† ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®š
â”‚   â”œâ”€â”€ 01-packages.config      â† ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
â”‚   â”œâ”€â”€ 02-files.config         â† ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
â”‚   â”œâ”€â”€ 03-commands.config      â† ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
â”‚   â”œâ”€â”€ 04-services.config      â† ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†
â”‚   â”œâ”€â”€ 05-options.config       â† ç’°å¢ƒè¨­å®š
â”‚   â””â”€â”€ 99-cleanup.config       â† ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
â””â”€â”€ .platform/                  â† Platform Hooks (AL2ä»¥é™)
    â”œâ”€â”€ hooks/
    â”‚   â”œâ”€â”€ prebuild/
    â”‚   â”œâ”€â”€ predeploy/
    â”‚   â””â”€â”€ postdeploy/
    â””â”€â”€ confighooks/
        â”œâ”€â”€ prebuild/
        â”œâ”€â”€ predeploy/
        â””â”€â”€ postdeploy/

â€» .config ãƒ•ã‚¡ã‚¤ãƒ«ã¯ YAML or JSONå½¢å¼
â€» ãƒ•ã‚¡ã‚¤ãƒ«åã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«å®Ÿè¡Œã•ã‚Œã‚‹
â€» ç•ªå·ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§å®Ÿè¡Œé †åºã‚’åˆ¶å¾¡
```

### 7.2 .ebextensionsã®ä¸»è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³

```yaml
# 01-packages.config
# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
packages:
  yum:
    gcc: []
    make: []
    openssl-devel: []

# 02-files.config
# ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
files:
  "/etc/nginx/conf.d/proxy.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      client_max_body_size 50M;
      proxy_read_timeout 300;

  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_restart_delayed_job.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      echo "Post-deploy hook executed"

# 03-commands.config
# ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚¢ãƒ—ãƒªå±•é–‹å‰ï¼‰
commands:
  01_create_directory:
    command: "mkdir -p /var/app/shared/logs"
  02_set_permissions:
    command: "chmod 755 /var/app/shared/logs"
  03_conditional_command:
    command: "echo 'Only on leader'"
    leader_only: true    # â† ãƒªãƒ¼ãƒ€ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã¿ã§å®Ÿè¡Œ

# 04-container-commands.config
# ã‚¢ãƒ—ãƒªå±•é–‹å¾Œã€èµ·å‹•å‰ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
container_commands:
  01_migrate_db:
    command: "python manage.py migrate"
    leader_only: true
  02_collectstatic:
    command: "python manage.py collectstatic --noinput"
  03_conditional:
    command: "echo 'Production only'"
    test: '[ "${NODE_ENV}" = "production" ]'
```

### 7.3 commands vs container_commands

| é …ç›® | commands | container_commands |
|------|---------|-------------------|
| **å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°** | ã‚¢ãƒ—ãƒªå±•é–‹å‰ | ã‚¢ãƒ—ãƒªå±•é–‹å¾Œã€èµ·å‹•å‰ |
| **ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª** | / (ãƒ«ãƒ¼ãƒˆ) | /var/app/staging/ |
| **ã‚¢ãƒ—ãƒªã‚³ãƒ¼ãƒ‰å‚ç…§** | ä¸å¯ | å¯èƒ½ |
| **leader_only** | å¯¾å¿œ | å¯¾å¿œ |
| **ç”¨é€”** | OSè¨­å®šã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ |

### 7.4 ç’°å¢ƒè¨­å®šã®.ebextensions

```yaml
# 05-options.config
option_settings:
  # ç’°å¢ƒå¤‰æ•°
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    DB_HOST: mydb.cluster-xxx.ap-northeast-1.rds.amazonaws.com
    CACHE_URL: mycluster.xxx.cache.amazonaws.com

  # ASGè¨­å®š
  aws:autoscaling:asg:
    MinSize: 2
    MaxSize: 6

  # èµ·å‹•è¨­å®š
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.medium
    SecurityGroups: sg-12345678
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role

  # ELBãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /health
    MatcherHTTPCode: "200"

  # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼
  aws:elasticbeanstalk:command:
    DeploymentPolicy: RollingWithAdditionalBatch
    BatchSizeType: Percentage
    BatchSize: 25
    Timeout: 600

  # ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ­ã‚°
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 30
```

### 7.5 ãƒªã‚½ãƒ¼ã‚¹ä½œæˆã®.ebextensions

```yaml
# 06-resources.config
# CloudFormationãƒªã‚½ãƒ¼ã‚¹ã‚’ç›´æ¥å®šç¾©å¯èƒ½
Resources:
  # SQSã‚­ãƒ¥ãƒ¼
  MySQSQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: my-app-queue
      VisibilityTimeout: 300

  # DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«
  MyDynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: my-app-table
      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
      KeySchema:
        - AttributeName: id
          KeyType: HASH
      BillingMode: PAY_PER_REQUEST

  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ«è¿½åŠ 
  MySecurityGroupIngress:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      GroupId:
        Fn::GetAtt:
          - AWSEBSecurityGroup
          - GroupId
      IpProtocol: tcp
      FromPort: 6379
      ToPort: 6379
      SourceSecurityGroupId: sg-redis-12345
```

### 7.6 Platform Hooks (Amazon Linux 2ä»¥é™)

```
ã€Platform Hooks ã®å®Ÿè¡Œé †åºã€‘

ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚:
  1. .platform/hooks/prebuild/    â† ãƒ“ãƒ«ãƒ‰å‰
  2. .platform/hooks/predeploy/   â† ãƒ‡ãƒ—ãƒ­ã‚¤å‰
  3. .platform/hooks/postdeploy/  â† ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œ

è¨­å®šå¤‰æ›´æ™‚:
  1. .platform/confighooks/prebuild/
  2. .platform/confighooks/predeploy/
  3. .platform/confighooks/postdeploy/

ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼:
â”œâ”€ ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (.sh)
â”œâ”€ å®Ÿè¡Œæ¨©é™ãŒå¿…è¦ (chmod +x)
â””â”€ åå‰ã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«å®Ÿè¡Œ
```

```bash
# Platform Hooks ã®ä¾‹

# .platform/hooks/predeploy/01_install_deps.sh
#!/bin/bash
set -e
echo "Installing additional dependencies..."
yum install -y ImageMagick

# .platform/hooks/postdeploy/01_run_migrations.sh
#!/bin/bash
set -e
cd /var/app/current
source /var/app/venv/*/bin/activate
python manage.py migrate --noinput
echo "Database migration completed"

# .platform/hooks/postdeploy/02_warm_cache.sh
#!/bin/bash
set -e
curl -s http://localhost:5000/api/warm-cache > /dev/null
echo "Cache warmed up"
```

### 7.7 .ebextensions vs Platform Hooks

| é …ç›® | .ebextensions | Platform Hooks |
|------|-------------|---------------|
| **å¯¾å¿œOS** | AL1/AL2/AL2023 | AL2/AL2023ã®ã¿ |
| **å½¢å¼** | YAML/JSON (.config) | ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ |
| **ç”¨é€”** | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸/ãƒ•ã‚¡ã‚¤ãƒ«/è¨­å®š/ãƒªã‚½ãƒ¼ã‚¹ | ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ |
| **æ¨å¥¨** | è¨­å®šãƒ»ãƒªã‚½ãƒ¼ã‚¹å®šç¾© | ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ«ãƒ‰/ãƒ‡ãƒ—ãƒ­ã‚¤ |
| **ãƒ‡ãƒãƒƒã‚°** | ã‚„ã‚„å›°é›£ | ãƒ­ã‚°ã§è¿½è·¡å®¹æ˜“ |

---

## 8. Beanstalk + Docker

### 8.1 Docker on Beanstalk ã®ç¨®é¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Elastic Beanstalk + Docker                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Single Container Docker  â”‚  â”‚  Multi-container Docker       â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚  (ECS on Beanstalk)           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚      EC2             â”‚ â”‚  â”‚  â”‚         EC2              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Container    â”‚  â”‚ â”‚  â”‚  â”‚  â”‚App  â”‚  â”‚Nginxâ”‚       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  (å˜ä¸€)       â”‚  â”‚ â”‚  â”‚  â”‚  â”‚     â”‚  â”‚     â”‚       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜       â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”                 â”‚ â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚  â”‚  â”‚Redisâ”‚  (ECSã‚¿ã‚¹ã‚¯)    â”‚ â”‚  â”‚
â”‚  â”‚  è¨­å®š: Dockerfile        â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚  â”‚
â”‚  â”‚        or Dockerrun.aws  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  è¨­å®š: Dockerrun.aws.json    â”‚  â”‚
â”‚                                  â”‚        v2 (ECSã‚¿ã‚¹ã‚¯å®šç¾©)    â”‚  â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â€» ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠã¯ECSã‚¯ãƒ©ã‚¹ã‚¿ã¨ã—ã¦ç®¡ç†ã•ã‚Œã‚‹                      â”‚
â”‚  â€» AL2023ã§ã¯Docker Composeã‚‚å¯¾å¿œ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Single Container Docker

```dockerfile
# Dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --production
COPY . .
EXPOSE 8080
CMD ["node", "server.js"]
```

```json
// Dockerrun.aws.json (v1) - ECRã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
{
  "AWSEBDockerrunVersion": "1",
  "Image": {
    "Name": "123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/my-app:latest",
    "Update": "true"
  },
  "Ports": [
    {
      "ContainerPort": 8080,
      "HostPort": 80
    }
  ],
  "Logging": "/var/log/app"
}
```

### 8.3 Multi-container Docker (Dockerrun.aws.json v2)

```json
// Dockerrun.aws.json (v2) - ECSã‚¿ã‚¹ã‚¯å®šç¾©å½¢å¼
{
  "AWSEBDockerrunVersion": 2,
  "containerDefinitions": [
    {
      "name": "nginx-proxy",
      "image": "nginx:latest",
      "essential": true,
      "memory": 128,
      "portMappings": [
        {
          "hostPort": 80,
          "containerPort": 80
        }
      ],
      "links": ["app"],
      "mountPoints": [
        {
          "sourceVolume": "nginx-config",
          "containerPath": "/etc/nginx/conf.d",
          "readOnly": true
        }
      ]
    },
    {
      "name": "app",
      "image": "123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/my-app:latest",
      "essential": true,
      "memory": 512,
      "portMappings": [
        {
          "hostPort": 3000,
          "containerPort": 3000
        }
      ],
      "environment": [
        {
          "name": "NODE_ENV",
          "value": "production"
        }
      ]
    }
  ],
  "volumes": [
    {
      "name": "nginx-config",
      "host": {
        "sourcePath": "/var/app/current/nginx"
      }
    }
  ]
}
```

### 8.4 Docker Compose on Beanstalk (AL2/AL2023)

```yaml
# docker-compose.yml
version: '3.8'
services:
  web:
    build: .
    ports:
      - "80:8080"
    environment:
      - NODE_ENV=production
      - DB_HOST=${RDS_HOSTNAME}
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
```

```bash
# Docker Compose ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤
# ã‚½ãƒ¼ã‚¹ãƒãƒ³ãƒ‰ãƒ«ã« docker-compose.yml ã‚’å«ã‚ã‚‹ã ã‘

# ã‚½ãƒ¼ã‚¹ãƒãƒ³ãƒ‰ãƒ«ä½œæˆ
zip -r app.zip . -x ".git/*" "node_modules/*"

# ãƒ‡ãƒ—ãƒ­ã‚¤
eb deploy
```

### 8.5 ECRã‹ã‚‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸å–å¾—è¨­å®š

```bash
# ECRèªè¨¼æƒ…å ±ã®è¨­å®š
# EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ãƒãƒªã‚·ãƒ¼ã‚’ä»˜ä¸

# IAMãƒãƒªã‚·ãƒ¼ä¾‹
cat << 'EOF'
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ecr:GetAuthorizationToken",
        "ecr:BatchCheckLayerAvailability",
        "ecr:GetDownloadUrlForLayer",
        "ecr:BatchGetImage"
      ],
      "Resource": "*"
    }
  ]
}
EOF
```

---

## 9. Workerç’°å¢ƒ (SQSé€£æº)

### 9.1 Workerç’°å¢ƒã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Beanstalk Workerç’°å¢ƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚  â”‚  Webç’°å¢ƒ     â”‚â”€ éåŒæœŸå‡¦ç†è¦æ±‚ â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  (API)       â”‚                     â”‚    SQS       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   ã‚­ãƒ¥ãƒ¼     â”‚             â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                               â”‚                      â”‚
â”‚                                               â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Workerç’°å¢ƒ                                â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  SQS Daemon  â”‚â”€â”€â”€â”€â–¶â”‚ Application  â”‚              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  (sqsd)      â”‚     â”‚ (HTTP POST   â”‚              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              â”‚     â”‚  localhost)   â”‚              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ ã‚­ãƒ¥ãƒ¼ãƒãƒ¼ãƒªãƒ³ã‚°â”‚   â”‚              â”‚              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—â”‚     â”‚ /worker      â”‚              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ å‰Šé™¤ç®¡ç†    â”‚     â”‚ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆâ”‚              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Auto Scaling: ã‚­ãƒ¥ãƒ¼æ·±åº¦ãƒ™ãƒ¼ã‚¹                              â”‚   â”‚
â”‚  â”‚  ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•° > é–¾å€¤                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Dead Letter Queue (DLQ):                                           â”‚
â”‚  â”œâ”€ å‡¦ç†å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€€é¿å…ˆ                                     â”‚
â”‚  â””â”€ maxReceiveCount è¶…éã§ DLQ ã«ç§»å‹•                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 SQS Daemon (sqsd) ã®å‹•ä½œ

```
ã€sqsd ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã€‘

1. SQS ã‚­ãƒ¥ãƒ¼ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°
2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ HTTP POST ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é€ä¿¡
   POST http://localhost/worker
   Content-Type: application/json
   X-Aws-Sqsd-Msgid: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID
   X-Aws-Sqsd-Queue: ã‚­ãƒ¥ãƒ¼URL
   X-Aws-Sqsd-First-Received-At: åˆå›å—ä¿¡æ™‚åˆ»
   X-Aws-Sqsd-Receive-Count: å—ä¿¡å›æ•°
   X-Aws-Sqsd-Attr-*: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±æ€§

3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ 200 OK ã‚’è¿”ã™ã¨:
   â†’ sqsd ãŒSQSã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤

4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ 200 ä»¥å¤–ã‚’è¿”ã™ã¨:
   â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ visibility timeout å¾Œã«å†å‡¦ç†
   â†’ maxReceiveCount è¶…éã§ DLQ ã«ç§»å‹•

é‡è¦è¨­å®š:
â”œâ”€ Worker Queue URL: ä½¿ç”¨ã™ã‚‹SQSã‚­ãƒ¥ãƒ¼
â”œâ”€ HTTP Path: POSTå…ˆã®ãƒ‘ã‚¹ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: /)
â”œâ”€ HTTP Connections: åŒæ™‚æ¥ç¶šæ•°
â”œâ”€ Visibility Timeout: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸å¯è¦–æ™‚é–“
â”œâ”€ Inactivity Timeout: HTTPå¿œç­”å¾…ã¡æ™‚é–“
â””â”€ Error Visibility Timeout: ã‚¨ãƒ©ãƒ¼æ™‚ã®ä¸å¯è¦–æ™‚é–“
```

### 9.3 å®šæœŸã‚¿ã‚¹ã‚¯ (cron.yaml)

```yaml
# cron.yaml - Workerç’°å¢ƒã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ã‚¹ã‚¯
version: 1
cron:
  - name: "daily-cleanup"
    url: "/scheduled/cleanup"
    schedule: "0 2 * * *"    # æ¯æ—¥AM2:00 (UTC)

  - name: "hourly-sync"
    url: "/scheduled/sync"
    schedule: "0 * * * *"    # æ¯æ™‚0åˆ†

  - name: "weekly-report"
    url: "/scheduled/report"
    schedule: "0 9 * * MON"  # æ¯é€±æœˆæ›œ AM9:00 (UTC)
```

```
ã€cron.yaml ã®ä»•çµ„ã¿ã€‘

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   cron.yaml  â”‚â”€â”€â”€â”€â”€â–¶â”‚    SQS       â”‚â”€â”€â”€â”€â”€â–¶â”‚   Worker     â”‚
â”‚  ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« â”‚      â”‚  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸  â”‚      â”‚  ã‚¢ãƒ—ãƒª      â”‚
â”‚  å®šç¾©        â”‚      â”‚  è‡ªå‹•æŠ•å…¥    â”‚      â”‚  HTTP POST   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€» Beanstalk ãŒãƒªãƒ¼ãƒ€ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ cron ã‚’ç®¡ç†
â€» SQS çµŒç”±ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•å…¥ã™ã‚‹ãŸã‚ã€é‡è¤‡å®Ÿè¡Œã®å¯èƒ½æ€§ã‚ã‚Š
â€» ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§å†ªç­‰æ€§ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨
```

### 9.4 Workerç’°å¢ƒã®è¨­å®š

```bash
# Workerç’°å¢ƒã®ä½œæˆ
aws elasticbeanstalk create-environment \
  --application-name my-app \
  --environment-name my-worker-env \
  --tier "Name=Worker,Type=SQS/HTTP" \
  --solution-stack-name "64bit Amazon Linux 2023 v6.1.0 running Node.js 20" \
  --version-label v1.0.0 \
  --option-settings \
    Namespace=aws:elasticbeanstalk:sqsd,OptionName=WorkerQueueURL,Value=https://sqs.ap-northeast-1.amazonaws.com/123456789012/my-queue \
    Namespace=aws:elasticbeanstalk:sqsd,OptionName=HttpPath,Value=/worker \
    Namespace=aws:elasticbeanstalk:sqsd,OptionName=HttpConnections,Value=5 \
    Namespace=aws:elasticbeanstalk:sqsd,OptionName=InactivityTimeout,Value=299 \
    Namespace=aws:elasticbeanstalk:sqsd,OptionName=VisibilityTimeout,Value=300 \
    Namespace=aws:elasticbeanstalk:sqsd,OptionName=ErrorVisibilityTimeout,Value=30

# Dead Letter Queueè¨­å®š
# .ebextensions/worker.config ã§è¨­å®š
```

```yaml
# .ebextensions/worker.config
option_settings:
  aws:elasticbeanstalk:sqsd:
    WorkerQueueURL: https://sqs.ap-northeast-1.amazonaws.com/123456789012/my-queue
    HttpPath: /worker
    MimeType: application/json
    HttpConnections: 5
    InactivityTimeout: 299
    VisibilityTimeout: 300
    RetentionPeriod: 345600
    ErrorVisibilityTimeout: 30
    MaxRetries: 3
```

---

## 10. ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’

### 10.1 æ¼”ç¿’1: Trusted Advisorãƒã‚§ãƒƒã‚¯ã®ç¢ºèª

```bash
# â€» Business/Enterprise ã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³å¿…è¦

# å…¨ãƒã‚§ãƒƒã‚¯ä¸€è¦§ã®å–å¾—
aws support describe-trusted-advisor-checks \
  --language ja \
  --query "checks[].{Category:category,Name:name}" \
  --output table

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚«ãƒ†ã‚´ãƒªã®ã¿
aws support describe-trusted-advisor-checks \
  --language ja \
  --query "checks[?category=='security'].{ID:id,Name:name}" \
  --output table

# ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™ãƒã‚§ãƒƒã‚¯ã®ã‚µãƒãƒªãƒ¼
aws support describe-trusted-advisor-checks \
  --language ja \
  --query "checks[?category=='service_limits'].id" \
  --output text | tr '\t' '\n' | head -5 | while read CHECK_ID; do
    echo "--- Check: $CHECK_ID ---"
    aws support describe-trusted-advisor-check-result \
      --check-id "$CHECK_ID" \
      --query "result.{Status:status,Flagged:resourcesSummary.resourcesFlagged}" \
      --output table
done

# ç‰¹å®šãƒã‚§ãƒƒã‚¯ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
aws support refresh-trusted-advisor-check \
  --check-id "Pfx0RwqBli"

# ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
aws support describe-trusted-advisor-check-refresh-statuses \
  --check-ids "Pfx0RwqBli"
```

### 10.2 æ¼”ç¿’2: Beanstalkã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã¨ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# EB CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install awsebcli

# 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
mkdir my-eb-app && cd my-eb-app

# Node.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ
cat > app.js << 'EOF'
const http = require('http');
const port = process.env.PORT || 8080;

const server = http.createServer((req, res) => {
  if (req.url === '/health') {
    res.writeHead(200);
    res.end('OK');
    return;
  }
  res.writeHead(200, { 'Content-Type': 'text/html' });
  res.end(`
    <h1>Elastic Beanstalk Demo</h1>
    <p>Version: ${process.env.APP_VERSION || '1.0.0'}</p>
    <p>Environment: ${process.env.NODE_ENV || 'development'}</p>
    <p>Hostname: ${require('os').hostname()}</p>
  `);
});

server.listen(port, () => {
  console.log(`Server running on port ${port}`);
});
EOF

cat > package.json << 'EOF'
{
  "name": "my-eb-app",
  "version": "1.0.0",
  "scripts": {
    "start": "node app.js"
  }
}
EOF

# 2. EB CLIã§åˆæœŸåŒ–
eb init my-eb-app \
  --platform "Node.js 20 running on 64bit Amazon Linux 2023" \
  --region ap-northeast-1

# 3. ç’°å¢ƒä½œæˆ
eb create prod-env \
  --instance_type t3.micro \
  --elb-type application \
  --scale 2

# 4. ç’°å¢ƒã®ç¢ºèª
eb status
eb health
eb logs

# 5. ç’°å¢ƒã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
eb open
```

### 10.3 æ¼”ç¿’3: .ebextensions ã®é©ç”¨

```bash
# .ebextensions ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
mkdir -p .ebextensions

# ç’°å¢ƒè¨­å®š
cat > .ebextensions/01-options.config << 'EOF'
option_settings:
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    APP_VERSION: "2.0.0"

  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /health
    MatcherHTTPCode: "200"

  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7
EOF

# Nginxã‚«ã‚¹ã‚¿ãƒ è¨­å®š
mkdir -p .platform/nginx/conf.d

cat > .platform/nginx/conf.d/custom.conf << 'EOF'
client_max_body_size 50M;
proxy_read_timeout 300;
EOF

# ãƒ‡ãƒ—ãƒ­ã‚¤
eb deploy

# è¨­å®šç¢ºèª
eb config
```

### 10.4 æ¼”ç¿’4: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼ã®å¤‰æ›´

```bash
# Rolling ãƒ‡ãƒ—ãƒ­ã‚¤ã«å¤‰æ›´
aws elasticbeanstalk update-environment \
  --environment-name prod-env \
  --option-settings \
    Namespace=aws:elasticbeanstalk:command,OptionName=DeploymentPolicy,Value=Rolling \
    Namespace=aws:elasticbeanstalk:command,OptionName=BatchSizeType,Value=Percentage \
    Namespace=aws:elasticbeanstalk:command,OptionName=BatchSize,Value=50

# è¨­å®šå¤‰æ›´ã®ç¢ºèª
aws elasticbeanstalk describe-configuration-settings \
  --application-name my-eb-app \
  --environment-name prod-env \
  --query "ConfigurationSettings[0].OptionSettings[?Namespace=='aws:elasticbeanstalk:command'].{Option:OptionName,Value:Value}" \
  --output table

# ã‚¢ãƒ—ãƒªã‚’æ›´æ–°ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆRollingã®å‹•ä½œç¢ºèªï¼‰
# app.js ã® APP_VERSION ã‚’æ›´æ–°
eb deploy --message "Rolling deploy test v2.1.0"

# ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–
eb events -f
```

### 10.5 æ¼”ç¿’5: Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# 1. æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
cat > app.js << 'APPEOF'
const http = require('http');
const port = process.env.PORT || 8080;

const server = http.createServer((req, res) => {
  if (req.url === '/health') {
    res.writeHead(200);
    res.end('OK');
    return;
  }
  res.writeHead(200, { 'Content-Type': 'text/html' });
  res.end(`
    <h1>Elastic Beanstalk Demo - V3 (Green)</h1>
    <p>Version: 3.0.0</p>
    <p>Hostname: ${require('os').hostname()}</p>
  `);
});

server.listen(port);
APPEOF

# 2. ã‚½ãƒ¼ã‚¹ãƒãƒ³ãƒ‰ãƒ«ã®ä½œæˆã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
zip -r app-v3.zip app.js package.json .ebextensions/ .platform/

aws s3 cp app-v3.zip s3://elasticbeanstalk-ap-northeast-1-123456789012/my-eb-app/app-v3.zip

# 3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä½œæˆ
aws elasticbeanstalk create-application-version \
  --application-name my-eb-app \
  --version-label v3.0.0 \
  --source-bundle S3Bucket=elasticbeanstalk-ap-northeast-1-123456789012,S3Key=my-eb-app/app-v3.zip

# 4. Greenç’°å¢ƒã®ä½œæˆ
eb create green-env \
  --version v3.0.0 \
  --instance_type t3.micro \
  --elb-type application \
  --scale 2

# 5. Greenç’°å¢ƒã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
aws elasticbeanstalk describe-environments \
  --environment-names green-env \
  --query "Environments[0].{Health:Health,HealthStatus:HealthStatus,CNAME:CNAME}"

# 6. CNAME swap
aws elasticbeanstalk swap-environment-cnames \
  --source-environment-name prod-env \
  --destination-environment-name green-env

# 7. ç¢ºèª
aws elasticbeanstalk describe-environments \
  --environment-names prod-env green-env \
  --query "Environments[].{Name:EnvironmentName,CNAME:CNAME,Version:VersionLabel}" \
  --output table

# 8. å•é¡ŒãŒã‚ã‚Œã°ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå†åº¦swapï¼‰
# aws elasticbeanstalk swap-environment-cnames \
#   --source-environment-name prod-env \
#   --destination-environment-name green-env
```

### 10.6 æ¼”ç¿’6: Workerç’°å¢ƒ

```bash
# 1. Workerã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ
mkdir my-worker && cd my-worker

cat > app.js << 'EOF'
const http = require('http');
const port = process.env.PORT || 8080;

const server = http.createServer((req, res) => {
  if (req.method === 'POST') {
    let body = '';
    req.on('data', chunk => body += chunk);
    req.on('end', () => {
      console.log('Received message:', body);
      console.log('Headers:', JSON.stringify(req.headers));

      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†
      try {
        const message = JSON.parse(body);
        console.log('Processing:', message);
        // å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯...
        res.writeHead(200);
        res.end('OK');
      } catch (e) {
        console.error('Processing error:', e);
        res.writeHead(500);
        res.end('Error');
      }
    });
  } else {
    res.writeHead(200);
    res.end('Worker is running');
  }
});

server.listen(port, () => {
  console.log(`Worker listening on port ${port}`);
});
EOF

# 2. cron.yaml ã®ä½œæˆ
cat > cron.yaml << 'EOF'
version: 1
cron:
  - name: "hourly-cleanup"
    url: "/scheduled/cleanup"
    schedule: "0 * * * *"
  - name: "daily-report"
    url: "/scheduled/report"
    schedule: "0 9 * * *"
EOF

# 3. Workerç’°å¢ƒã®ä½œæˆ
eb init my-worker-app --platform "Node.js 20" --region ap-northeast-1
eb create worker-env --tier worker --instance_type t3.micro

# 4. ãƒ†ã‚¹ãƒˆ: SQSã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
QUEUE_URL=$(aws elasticbeanstalk describe-configuration-settings \
  --application-name my-worker-app \
  --environment-name worker-env \
  --query "ConfigurationSettings[0].OptionSettings[?OptionName=='WorkerQueueURL'].Value" \
  --output text)

aws sqs send-message \
  --queue-url "$QUEUE_URL" \
  --message-body '{"task":"process","data":{"id":123}}'

# 5. ãƒ­ã‚°ç¢ºèª
eb logs --all
```

### 10.7 ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```bash
# Beanstalkç’°å¢ƒã®å‰Šé™¤
eb terminate prod-env --force
eb terminate green-env --force
eb terminate worker-env --force

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‰Šé™¤
aws elasticbeanstalk delete-application \
  --application-name my-eb-app \
  --terminate-env-by-force

aws elasticbeanstalk delete-application \
  --application-name my-worker-app \
  --terminate-env-by-force

# EventBridgeãƒ«ãƒ¼ãƒ«ã®å‰Šé™¤ï¼ˆus-east-1ï¼‰
aws events remove-targets \
  --region us-east-1 \
  --rule "trusted-advisor-security-alert" \
  --ids "sns-notification"

aws events delete-rule \
  --region us-east-1 \
  --name "trusted-advisor-security-alert"
```

---

## 11. DOPè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Trusted AdvisoråŸºæœ¬

- [ ] Trusted Advisorã®5ã¤ã®ã‚«ãƒ†ã‚´ãƒªã‚’å…¨ã¦æŒ™ã’ã‚‰ã‚Œã‚‹
- [ ] ã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³åˆ¥ã«åˆ©ç”¨å¯èƒ½ãªãƒã‚§ãƒƒã‚¯ã®é•ã„ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] Basic/Developerãƒ—ãƒ©ãƒ³ã§åˆ©ç”¨ã§ãã‚‹ãƒã‚§ãƒƒã‚¯é …ç›®ã‚’çŸ¥ã£ã¦ã„ã‚‹

<details>
<summary>æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**5ã¤ã®ã‚«ãƒ†ã‚´ãƒª**:
1. **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**: æœªä½¿ç”¨EIPã€ä½ä½¿ç”¨ç‡EC2ã€ã‚¢ã‚¤ãƒ‰ãƒ«RDS/LB
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: é«˜ä½¿ç”¨ç‡EC2ã€CloudFrontæœ€é©åŒ–
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: SGã®0.0.0.0/0ã€S3ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã€IAMã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€MFA
4. **è€éšœå®³æ€§**: EBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã€RDSãƒãƒ«ãƒAZã€ASGãƒãƒ«ãƒAZ
5. **ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™**: VPCã€EIPã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ï¼ˆ80%è¶…ã§è­¦å‘Šï¼‰

**ãƒ—ãƒ©ãƒ³åˆ¥ã®é•ã„**:
- Basic/Developer: ã‚³ã‚¢ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ï¼ˆ6é …ç›®ï¼‰+ ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™ã®ã¿
- Business/Enterprise: å…¨ãƒã‚§ãƒƒã‚¯é …ç›® + API + EventBridgeé€£æº + ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥

**Basic/Developerã§åˆ©ç”¨å¯èƒ½**:
- SGã®ç„¡åˆ¶é™ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆç‰¹å®šãƒãƒ¼ãƒˆï¼‰
- S3ãƒã‚±ãƒƒãƒˆã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹
- ãƒ«ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®MFA
- IAMä½¿ç”¨çŠ¶æ³
- EBSãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
- RDSãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
- ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™
</details>

### Trusted Advisor + EventBridge

- [ ] EventBridgeãƒ«ãƒ¼ãƒ«ã®è¨­å®šå ´æ‰€ï¼ˆãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ã‚’çŸ¥ã£ã¦ã„ã‚‹
- [ ] Trusted Advisorã®ã‚¤ãƒ™ãƒ³ãƒˆæ§‹é€ ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] è‡ªå‹•ä¿®å¾©ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è¨­è¨ˆã§ãã‚‹

<details>
<summary>æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**EventBridgeãƒ«ãƒ¼ãƒ«ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**:
- **us-east-1 (N. Virginia) ã§ã®ã¿è¨­å®šå¯èƒ½**ï¼ˆæœ€é »å‡ºãƒã‚¤ãƒ³ãƒˆï¼‰
- Trusted Advisorã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦N. Virginiaã«é€ä¿¡ã•ã‚Œã‚‹

**ã‚¤ãƒ™ãƒ³ãƒˆæ§‹é€ **:
```json
{
  "source": "aws.trustedadvisor",
  "detail-type": "Trusted Advisor Check Item Refresh Notification",
  "detail": {
    "check-name": "ãƒã‚§ãƒƒã‚¯å",
    "status": "WARN|ERROR|OK",
    "check-item-detail": { ... }
  }
}
```

**è‡ªå‹•ä¿®å¾©ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**:
```
Trusted Advisor â†’ EventBridge (us-east-1)
  â†’ Lambdaï¼ˆè‡ªå‹•ä¿®å¾©ï¼‰â†’ EC2 APIï¼ˆSGä¿®æ­£ç­‰ï¼‰
  â†’ SNSï¼ˆé€šçŸ¥ï¼‰â†’ ãƒ¡ãƒ¼ãƒ«/Slack
  â†’ Systems Managerï¼ˆãƒ‘ãƒƒãƒé©ç”¨ç­‰ï¼‰
```
</details>

### Organizationå˜ä½ã®Trusted Advisor

- [ ] çµ„ç¹”ãƒ“ãƒ¥ãƒ¼ã®æœ‰åŠ¹åŒ–æ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ã‚‹
- [ ] ãƒ¬ãƒãƒ¼ãƒˆã®å‡ºåŠ›å…ˆã¨åˆ†ææ–¹æ³•ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] Trusted Advisor Priorityã®ç‰¹å¾´ã‚’èª¬æ˜ã§ãã‚‹

<details>
<summary>æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**çµ„ç¹”ãƒ“ãƒ¥ãƒ¼**:
- Management Accountã§æœ‰åŠ¹åŒ–
- çµ„ç¹”å…¨ä½“ã®ãƒã‚§ãƒƒã‚¯çµæœã‚’é›†ç´„ãƒ»å¯è¦–åŒ–
- S3ã«JSON/CSVãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›
- QuickSightã‚„Athenaã§åˆ†æå¯èƒ½

**ãƒ¬ãƒãƒ¼ãƒˆåˆ†æ**:
1. S3ã«ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›
2. Athenaã§ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆJSON SerDeï¼‰
3. SQLã§ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¥ã®å•é¡Œæ•°ã‚’é›†è¨ˆ
4. QuickSightã§å¯è¦–åŒ–

**Trusted Advisor Priority**:
- Enterprise ã‚µãƒãƒ¼ãƒˆé™å®š
- TAMï¼ˆãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ï¼‰ãŒå„ªå…ˆé †ä½ä»˜ã‘
- AWS Health ã¨çµ±åˆ
- çµ„ç¹”å…¨ä½“ã®ãƒªã‚¹ã‚¯ã‚’å„ªå…ˆåº¦é †ã«è¡¨ç¤º
- APIã§ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹å¯¾å¿œ
</details>

### Beanstalkãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼

- [ ] 6ã¤ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼ã®ç‰¹å¾´ã¨é•ã„ã‚’èª¬æ˜ã§ãã‚‹
- [ ] ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ãƒãƒªã‚·ãƒ¼ã‚’ç‰¹å®šã§ãã‚‹
- [ ] å„ãƒãƒªã‚·ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ã‚‹

<details>
<summary>æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**6ã¤ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒªã‚·ãƒ¼**:

| ãƒãƒªã‚·ãƒ¼ | ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  | ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ |
|---------|:----------:|:----------:|:----------:|
| All at once | ã‚ã‚Š | å†ãƒ‡ãƒ—ãƒ­ã‚¤ | æ¸›å°‘ |
| Rolling | ãªã— | å†ãƒ‡ãƒ—ãƒ­ã‚¤ | ä¸€æ™‚æ¸›å°‘ |
| Rolling w/ batch | ãªã— | å†ãƒ‡ãƒ—ãƒ­ã‚¤ | ç¶­æŒ |
| Immutable | ãªã— | æ–°ASGå‰Šé™¤ | å€å¢— |
| Traffic splitting | ãªã— | æ–°ASGå‰Šé™¤ | å€å¢— |
| Blue/Green | æœ€å° | CNAME swap | å€å¢— |

**ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ã®ã¯ã€ŒAll at onceã€ã®ã¿**

**ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ–¹æ³•**:
- All at once / Rolling / Rolling w/ batch: å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å†ãƒ‡ãƒ—ãƒ­ã‚¤
- Immutable / Traffic splitting: æ–°ã—ã„ASGã‚’å‰Šé™¤ã™ã‚‹ã ã‘ï¼ˆé«˜é€Ÿï¼‰
- Blue/Green: CNAME swapã‚’å†å®Ÿè¡Œã™ã‚‹ã ã‘ï¼ˆæœ€é€Ÿï¼‰

**è©¦é¨“é »å‡º**: ã€Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã— + é«˜é€Ÿãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€â†’ ImmutableãŒæ­£è§£
**è©¦é¨“é »å‡º**: ã€Œå®Œå…¨ã«ç‹¬ç«‹ã—ãŸç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã€â†’ Blue/GreenãŒæ­£è§£
</details>

### .ebextensions ã¨ Platform Hooks

- [ ] .ebextensionsã®ä¸»è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆpackages, files, commands, container_commandsï¼‰ã‚’ä½¿ã„åˆ†ã‘ã§ãã‚‹
- [ ] commands ã¨ container_commands ã®é•ã„ã‚’èª¬æ˜ã§ãã‚‹
- [ ] leader_only ã®ç”¨é€”ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] Platform Hooksã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’çŸ¥ã£ã¦ã„ã‚‹

<details>
<summary>æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**ä¸»è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
- `packages`: OS/è¨€èªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆyum, apt, pip, npmï¼‰
- `files`: ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆç­‰ï¼‰
- `commands`: ã‚¢ãƒ—ãƒªå±•é–‹å‰ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼ˆOSè¨­å®šç­‰ï¼‰
- `container_commands`: ã‚¢ãƒ—ãƒªå±•é–‹å¾Œã€èµ·å‹•å‰ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼ˆDBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ï¼‰
- `option_settings`: Beanstalkè¨­å®šã®å¤‰æ›´
- `Resources`: CloudFormationãƒªã‚½ãƒ¼ã‚¹ã®è¿½åŠ 

**commands vs container_commands**:
| é …ç›® | commands | container_commands |
|------|---------|-------------------|
| å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚° | ã‚¢ãƒ—ãƒªå±•é–‹å‰ | ã‚¢ãƒ—ãƒªå±•é–‹å¾Œã€èµ·å‹•å‰ |
| ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | / | /var/app/staging/ |
| ã‚¢ãƒ—ãƒªã‚³ãƒ¼ãƒ‰å‚ç…§ | ä¸å¯ | å¯èƒ½ |

**leader_only**:
- ASGå†…ã®1ã¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ï¼‰ã§ã®ã¿å®Ÿè¡Œ
- DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã©1å›ã ã‘å®Ÿè¡Œã™ã¹ãå‡¦ç†ã«ä½¿ç”¨
- commands, container_commands ä¸¡æ–¹ã§ä½¿ç”¨å¯èƒ½

**Platform Hooks**:
```
.platform/
â”œâ”€â”€ hooks/          â† ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚
â”‚   â”œâ”€â”€ prebuild/   â† ãƒ“ãƒ«ãƒ‰å‰
â”‚   â”œâ”€â”€ predeploy/  â† ãƒ‡ãƒ—ãƒ­ã‚¤å‰
â”‚   â””â”€â”€ postdeploy/ â† ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œ
â””â”€â”€ confighooks/    â† è¨­å®šå¤‰æ›´æ™‚
    â”œâ”€â”€ prebuild/
    â”œâ”€â”€ predeploy/
    â””â”€â”€ postdeploy/
```
</details>

### Beanstalk + Docker

- [ ] Single Containerã¨Multi-containerã®é•ã„ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] Dockerrun.aws.json v1ã¨v2ã®é•ã„ã‚’çŸ¥ã£ã¦ã„ã‚‹
- [ ] ECRã‹ã‚‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸å–å¾—ã«å¿…è¦ãªè¨­å®šã‚’èª¬æ˜ã§ãã‚‹

<details>
<summary>æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**Single vs Multi-container**:
- Single: 1ã¤ã®Dockerã‚³ãƒ³ãƒ†ãƒŠã€Dockerfile or Dockerrun.aws.json v1
- Multi: è¤‡æ•°ã®Dockerã‚³ãƒ³ãƒ†ãƒŠã€Dockerrun.aws.json v2ï¼ˆECSã‚¿ã‚¹ã‚¯å®šç¾©å½¢å¼ï¼‰
- AL2/AL2023ã§ã¯Docker Composeã‚‚åˆ©ç”¨å¯èƒ½

**Dockerrun.aws.json**:
- v1: Single Containerç”¨ã€ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¤ãƒ¡ãƒ¼ã‚¸/ãƒãƒ¼ãƒˆæŒ‡å®š
- v2: Multi-containerç”¨ã€ECSã‚¿ã‚¹ã‚¯å®šç¾©å½¢å¼ã§è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã‚’å®šç¾©
- v2ã¯ECSã‚¯ãƒ©ã‚¹ã‚¿ã¨ã—ã¦ç®¡ç†ã•ã‚Œã‚‹

**ECRã‚¤ãƒ¡ãƒ¼ã‚¸å–å¾—ã«å¿…è¦ãªè¨­å®š**:
1. EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®IAMãƒãƒªã‚·ãƒ¼ã‚’ä»˜ä¸:
   - `ecr:GetAuthorizationToken`
   - `ecr:BatchCheckLayerAvailability`
   - `ecr:GetDownloadUrlForLayer`
   - `ecr:BatchGetImage`
2. Dockerrun.aws.jsonã®Image.Nameã«ECR URIã‚’æŒ‡å®š
</details>

### Workerç’°å¢ƒ

- [ ] Workerç’°å¢ƒã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆsqsdï¼‰ã‚’èª¬æ˜ã§ãã‚‹
- [ ] cron.yamlã®ç”¨é€”ã¨åˆ¶ç´„ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] Dead Letter Queueã®å‹•ä½œã‚’èª¬æ˜ã§ãã‚‹

<details>
<summary>æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**Workerç’°å¢ƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**:
- SQSã‚­ãƒ¥ãƒ¼ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹sqsdãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒå‹•ä½œ
- sqsdãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’HTTP POSTã§localhostã®ã‚¢ãƒ—ãƒªã«é€ä¿¡
- ã‚¢ãƒ—ãƒªãŒ200ã‚’è¿”ã™ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤ã€ãã‚Œä»¥å¤–ã¯å†å‡¦ç†
- ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¯ã‚­ãƒ¥ãƒ¼æ·±åº¦ãƒ™ãƒ¼ã‚¹

**cron.yaml**:
- Workerç’°å¢ƒã§å®šæœŸã‚¿ã‚¹ã‚¯ã‚’å®šç¾©
- ãƒªãƒ¼ãƒ€ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç®¡ç†
- SQSçµŒç”±ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•å…¥
- **æ³¨æ„**: é‡è¤‡å®Ÿè¡Œã®å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§å†ªç­‰æ€§ã‚’ç¢ºä¿

**Dead Letter Queue (DLQ)**:
- å‡¦ç†å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€€é¿å…ˆ
- maxReceiveCountï¼ˆæœ€å¤§å—ä¿¡å›æ•°ï¼‰ã‚’è¶…éã™ã‚‹ã¨DLQã«ç§»å‹•
- DLQã®è¨­å®šã¯SQSã‚­ãƒ¥ãƒ¼å´ã§è¡Œã†ï¼ˆredrive policyï¼‰
- DLQã«æºœã¾ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯CloudWatch ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ç›£è¦–
</details>

### è©¦é¨“é »å‡ºã‚·ãƒŠãƒªã‚ª

- [ ] ã€Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—ã§æœ€é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ Rolling
- [ ] ã€Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã— + ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ç¶­æŒã€â†’ Rolling with additional batch
- [ ] ã€Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã— + é«˜é€Ÿãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€â†’ Immutable
- [ ] ã€Œæ®µéšçš„ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ç§»è¡Œã€â†’ Traffic splitting
- [ ] ã€Œå®Œå…¨ç‹¬ç«‹ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆå¾Œã«åˆ‡æ›¿ã€â†’ Blue/Green (CNAME swap)
- [ ] ã€ŒTrusted Advisorã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é•åã‚’è‡ªå‹•æ¤œçŸ¥ãƒ»ä¿®å¾©ã€â†’ EventBridge + Lambda (us-east-1)
- [ ] ã€Œçµ„ç¹”å…¨ä½“ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æº–æ‹ çŠ¶æ³ã‚’æŠŠæ¡ã€â†’ Trusted Advisor çµ„ç¹”ãƒ“ãƒ¥ãƒ¼
- [ ] ã€ŒDBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’1å›ã ã‘å®Ÿè¡Œã€â†’ container_commands + leader_only

<details>
<summary>æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**ã‚·ãƒŠãƒªã‚ªåˆ¥ã®æ­£è§£ãƒ‘ã‚¿ãƒ¼ãƒ³**:

1. ã€Œã‚¢ãƒ—ãƒªã®æ›´æ–°æ™‚ã«ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’è¨±å®¹ã§ããªã„ã€‚ãŸã ã—ã‚³ã‚¹ãƒˆã¯æœ€å°é™ã«ã—ãŸã„ã€
   â†’ **Rolling**: ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã¯ä¸€æ™‚çš„ã«æ¸›å°‘ã™ã‚‹ãŒè¿½åŠ ã‚³ã‚¹ãƒˆãªã—

2. ã€Œæœ¬ç•ªç’°å¢ƒã®ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚’ç¶­æŒã—ãªãŒã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„ã€
   â†’ **Rolling with additional batch**: æ–°ãƒãƒƒãƒã‚’è¿½åŠ ã—ã¦ã‹ã‚‰ãƒ­ãƒ¼ãƒªãƒ³ã‚°

3. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—æ™‚ã«å³åº§ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ãŸã„ã€
   â†’ **Immutable**: æ–°ASGã‚’å‰Šé™¤ã™ã‚‹ã ã‘ã§å³æ™‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

4. ã€Œæ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å°‘é‡ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’æµã—ã¦æ¤œè¨¼ã—ãŸã„ã€
   â†’ **Traffic splitting**: ALBã®Weighted Target Groupã§æ®µéšçš„ç§»è¡Œ

5. ã€Œå®Œå…¨ã«ç‹¬ç«‹ã—ãŸç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã—ã¦ã‹ã‚‰URLã‚’åˆ‡ã‚Šæ›¿ãˆãŸã„ã€
   â†’ **Blue/Green (CNAME swap)**: åˆ¥ç’°å¢ƒã§å®Œå…¨ãƒ†ã‚¹ãƒˆå¾Œã«CNAMEäº¤æ›

6. ã€ŒSGã®0.0.0.0/0ã‚’è‡ªå‹•æ¤œçŸ¥ã—ã¦ä¿®å¾©ã—ãŸã„ã€
   â†’ **Trusted Advisor + EventBridge (us-east-1) + Lambda**

7. ã€ŒWorkerç’°å¢ƒã§DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸã„ã€
   â†’ **container_commands + leader_only: true**
   ```yaml
   container_commands:
     01_migrate:
       command: "python manage.py migrate"
       leader_only: true
   ```

8. ã€Œå®šæœŸçš„ãªãƒãƒƒãƒå‡¦ç†ã‚’Beanstalkã§å®Ÿè¡Œã—ãŸã„ã€
   â†’ **Workerç’°å¢ƒ + cron.yaml**ï¼ˆå†ªç­‰æ€§ã«æ³¨æ„ï¼‰
</details>

---

## ä»˜éŒ²: ã‚ˆãä½¿ã†CLIã‚³ãƒãƒ³ãƒ‰

### Trusted Advisor

```bash
# ãƒã‚§ãƒƒã‚¯ä¸€è¦§
aws support describe-trusted-advisor-checks --language ja

# ãƒã‚§ãƒƒã‚¯çµæœã‚µãƒãƒªãƒ¼
aws support describe-trusted-advisor-check-summaries --check-ids ID1 ID2

# ãƒã‚§ãƒƒã‚¯çµæœè©³ç´°
aws support describe-trusted-advisor-check-result --check-id ID

# ãƒã‚§ãƒƒã‚¯ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
aws support refresh-trusted-advisor-check --check-id ID

# ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
aws support describe-trusted-advisor-check-refresh-statuses --check-ids ID1

# â€» support API ã¯ us-east-1 ã§ã®ã¿åˆ©ç”¨å¯èƒ½
```

### Elastic Beanstalk

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†
aws elasticbeanstalk create-application --application-name NAME
aws elasticbeanstalk describe-applications
aws elasticbeanstalk delete-application --application-name NAME

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
aws elasticbeanstalk create-application-version --application-name NAME --version-label LABEL --source-bundle ...
aws elasticbeanstalk describe-application-versions --application-name NAME
aws elasticbeanstalk delete-application-version --application-name NAME --version-label LABEL

# ç’°å¢ƒç®¡ç†
aws elasticbeanstalk create-environment --application-name NAME --environment-name ENV ...
aws elasticbeanstalk describe-environments --environment-names ENV
aws elasticbeanstalk update-environment --environment-name ENV --option-settings ...
aws elasticbeanstalk terminate-environment --environment-name ENV
aws elasticbeanstalk rebuild-environment --environment-name ENV

# ãƒ‡ãƒ—ãƒ­ã‚¤
aws elasticbeanstalk update-environment --environment-name ENV --version-label LABEL

# Blue/Green
aws elasticbeanstalk swap-environment-cnames --source-environment-name ENV1 --destination-environment-name ENV2

# è¨­å®š
aws elasticbeanstalk describe-configuration-settings --application-name NAME --environment-name ENV
aws elasticbeanstalk describe-configuration-options --application-name NAME --environment-name ENV
aws elasticbeanstalk validate-configuration-settings --application-name NAME --option-settings ...

# ãƒ˜ãƒ«ã‚¹
aws elasticbeanstalk describe-environment-health --environment-name ENV --attribute-names All
aws elasticbeanstalk describe-instances-health --environment-name ENV

# ã‚¤ãƒ™ãƒ³ãƒˆ
aws elasticbeanstalk describe-events --environment-name ENV --max-records 20

# EB CLI
eb init / eb create / eb deploy / eb status / eb health
eb logs / eb events / eb config / eb open / eb terminate
```

---

**ä½œæˆæ—¥**: 2026-02-04
**æœ€çµ‚æ›´æ–°**: 2026-02-04
**æ¤œè¨¼ç’°å¢ƒ**: AWS ap-northeast-1 ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
