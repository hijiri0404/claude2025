# AWS Auto Scaling & ELB ãƒãƒ³ã‚ºã‚ªãƒ³ã‚¬ã‚¤ãƒ‰

> **å¯¾è±¡**: AWS DevOps Professional (DOP-C02) è©¦é¨“å¯¾ç­–
> **å‰æçŸ¥è­˜**: EC2åŸºç¤ã€VPCã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç¤
> **æ‰€è¦æ™‚é–“**: ç´„3æ™‚é–“

---

## ç›®æ¬¡

1. [Auto Scalingæ¦‚è¦](#1-auto-scalingæ¦‚è¦)
2. [èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](#2-èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)
3. [ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼](#3-ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼)
4. [Elastic Load Balancing](#4-elastic-load-balancing)
5. [ALBè©³ç´°](#5-albè©³ç´°)
6. [NLB / GWLB](#6-nlb--gwlb)
7. [ASG + ELBé€£æº](#7-asg--elbé€£æº)
8. [ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’](#8-ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’)
9. [DOPè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#9-dopè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)

---

## 1. Auto Scalingæ¦‚è¦

### 1.1 Auto Scalingã®ç¨®é¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AWS Auto Scaling                                   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  EC2 Auto Scaling                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ Auto Scaling Group (ASG)                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ / èµ·å‹•è¨­å®š                              â”‚  â”‚
â”‚  â”‚  â””â”€ ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Application Auto Scalingï¼ˆä»–ã‚µãƒ¼ãƒ“ã‚¹ï¼‰                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ ECS ã‚µãƒ¼ãƒ“ã‚¹                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«/GSI                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Aurora ãƒ¬ãƒ—ãƒªã‚«                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Lambda åŒæ™‚å®Ÿè¡Œ                                        â”‚  â”‚
â”‚  â”‚  â””â”€ ãã®ä»–                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AWS Auto Scaling (Scaling Plans)                            â”‚  â”‚
â”‚  â”‚  â””â”€ è¤‡æ•°ãƒªã‚½ãƒ¼ã‚¹ã®çµ±åˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ASGã®åŸºæœ¬

```
ã€Auto Scaling Group æ§‹æˆã€‘

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Auto Scaling Group                         â”‚
â”‚                                                              â”‚
â”‚  Min: 2          Desired: 3          Max: 6                 â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              AZ-a              AZ-c                  â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚   â”‚ Instance 1  â”‚    â”‚ Instance 3  â”‚               â”‚   â”‚
â”‚  â”‚   â”‚ (Running)   â”‚    â”‚ (Running)   â”‚               â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚   â”‚
â”‚  â”‚   â”‚ Instance 2  â”‚                                   â”‚   â”‚
â”‚  â”‚   â”‚ (Running)   â”‚                                   â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼:                                       â”‚
â”‚  â”œâ”€ Target Tracking: CPU 70% ç¶­æŒ                           â”‚
â”‚  â”œâ”€ Step Scaling: CPU 80%â†’+2, CPU 90%â†’+4                   â”‚
â”‚  â””â”€ Scheduled: å¹³æ—¥9:00 Min=4, 18:00 Min=2                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### 2.1 èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ vs èµ·å‹•è¨­å®š

| é …ç›® | èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | èµ·å‹•è¨­å®šï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ï¼‰ |
|------|---------------|-------------------|
| **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†** | ã‚ã‚Š | ãªã— |
| **éƒ¨åˆ†è¨­å®š** | å¯èƒ½ï¼ˆç¶™æ‰¿ï¼‰ | ä¸å¯ |
| **Mixed Instances** | å¯¾å¿œ | éå¯¾å¿œ |
| **ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹** | æŸ”è»Ÿãªè¨­å®š | åŸºæœ¬ã®ã¿ |
| **æ¨å¥¨** | â˜…â˜…â˜…â˜…â˜… | éæ¨å¥¨ |

### 2.2 èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½œæˆ

```bash
# èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½œæˆ
aws ec2 create-launch-template \
  --launch-template-name web-server-template \
  --version-description "v1 - initial" \
  --launch-template-data '{
    "ImageId": "ami-0abcdef1234567890",
    "InstanceType": "t3.micro",
    "KeyName": "my-key",
    "SecurityGroupIds": ["sg-12345678"],
    "UserData": "'$(echo -n '#!/bin/bash\nyum install -y httpd\nsystemctl start httpd' | base64)'",
    "TagSpecifications": [
      {
        "ResourceType": "instance",
        "Tags": [
          {"Key": "Name", "Value": "WebServer"},
          {"Key": "Environment", "Value": "Production"}
        ]
      }
    ],
    "Monitoring": {"Enabled": true},
    "IamInstanceProfile": {
      "Name": "EC2-SSM-Role"
    }
  }'

# æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä½œæˆ
aws ec2 create-launch-template-version \
  --launch-template-name web-server-template \
  --source-version 1 \
  --version-description "v2 - instance type change" \
  --launch-template-data '{"InstanceType": "t3.small"}'
```

---

## 3. ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼

### 3.1 ãƒãƒªã‚·ãƒ¼ã®ç¨®é¡

```
ã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼æ¯”è¼ƒã€‘

1. Target Trackingï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ï¼‰â˜…æœ€æ¨å¥¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›®æ¨™: CPU 70%                            â”‚
â”‚                                          â”‚
â”‚  CPU: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 70% â”€â”€â”€â”€â”€â”€        â”‚
â”‚       80%â†’ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ                 â”‚
â”‚       60%â†’ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³                   â”‚
â”‚                                          â”‚
â”‚ ç‰¹å¾´: è‡ªå‹•çš„ã«ç›®æ¨™å€¤ã‚’ç¶­æŒ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Step Scalingï¼ˆã‚¹ãƒ†ãƒƒãƒ—ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ®µéšçš„ã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°é‡ã‚’å¤‰æ›´             â”‚
â”‚                                          â”‚
â”‚  CPU 60-70%: +1 instance                â”‚
â”‚  CPU 70-80%: +2 instances               â”‚
â”‚  CPU 80%+:   +4 instances               â”‚
â”‚                                          â”‚
â”‚ ç‰¹å¾´: è² è·ã«å¿œã˜ãŸæŸ”è»Ÿãªåˆ¶å¾¡            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Simple Scalingï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¢ãƒ©ãƒ¼ãƒ ç™ºç«æ™‚ã«å›ºå®šæ•°ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°        â”‚
â”‚                                          â”‚
â”‚  CPU > 80%: +2 instances                â”‚
â”‚  ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³: 300ç§’                     â”‚
â”‚                                          â”‚
â”‚ ç‰¹å¾´: ãƒ¬ã‚¬ã‚·ãƒ¼ã€ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³å¾…ã¡ãŒç™ºç”Ÿ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Scheduled Scalingï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ™‚é–“æŒ‡å®šã§ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£å¤‰æ›´               â”‚
â”‚                                          â”‚
â”‚  å¹³æ—¥ 9:00: Min=4, Desired=4            â”‚
â”‚  å¹³æ—¥ 18:00: Min=2, Desired=2           â”‚
â”‚  é€±æœ«: Min=1                             â”‚
â”‚                                          â”‚
â”‚ ç‰¹å¾´: äºˆæ¸¬å¯èƒ½ãªè² è·ãƒ‘ã‚¿ãƒ¼ãƒ³å‘ã‘        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. Predictive Scalingï¼ˆäºˆæ¸¬ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ©Ÿæ¢°å­¦ç¿’ã§éœ€è¦ã‚’äºˆæ¸¬                     â”‚
â”‚                                          â”‚
â”‚  éå»14æ—¥é–“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æ              â”‚
â”‚  â†’ äº‹å‰ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èµ·å‹•              â”‚
â”‚                                          â”‚
â”‚ ç‰¹å¾´: Target Trackingã¨ä½µç”¨æ¨å¥¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ

```bash
# ASGä½œæˆ
aws autoscaling create-auto-scaling-group \
  --auto-scaling-group-name web-asg \
  --launch-template "LaunchTemplateName=web-server-template,Version=\$Latest" \
  --min-size 2 \
  --max-size 6 \
  --desired-capacity 3 \
  --vpc-zone-identifier "subnet-12345678,subnet-87654321" \
  --health-check-type ELB \
  --health-check-grace-period 300

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ãƒãƒªã‚·ãƒ¼
aws autoscaling put-scaling-policy \
  --auto-scaling-group-name web-asg \
  --policy-name cpu-target-tracking \
  --policy-type TargetTrackingScaling \
  --target-tracking-configuration '{
    "PredefinedMetricSpecification": {
      "PredefinedMetricType": "ASGAverageCPUUtilization"
    },
    "TargetValue": 70.0,
    "ScaleInCooldown": 300,
    "ScaleOutCooldown": 60
  }'
```

### 3.3 ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯

```
ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ã®æµã‚Œã€‘

ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆæ™‚:
  Pending â†’ Pending:Wait â†’ Pending:Proceed â†’ InService
                â†‘
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Lifecycle Hookâ”‚
        â”‚               â”‚
        â”‚ ãƒ»AMIæº–å‚™     â”‚
        â”‚ ãƒ»è¨­å®šé©ç”¨    â”‚
        â”‚ ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³æ™‚:
  InService â†’ Terminating â†’ Terminating:Wait â†’ Terminating:Proceed â†’ Terminated
                                   â†‘
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ Lifecycle Hookâ”‚
                           â”‚               â”‚
                           â”‚ ãƒ»ãƒ­ã‚°é€€é¿    â”‚
                           â”‚ ãƒ»æ¥ç¶šãƒ‰ãƒ¬ã‚¤ãƒ³ â”‚
                           â”‚ ãƒ»ãƒ‡registrationâ”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```bash
# ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ã®è¿½åŠ 
aws autoscaling put-lifecycle-hook \
  --auto-scaling-group-name web-asg \
  --lifecycle-hook-name launch-hook \
  --lifecycle-transition autoscaling:EC2_INSTANCE_LAUNCHING \
  --heartbeat-timeout 300 \
  --default-result CONTINUE \
  --notification-target-arn "arn:aws:sns:ap-northeast-1:123456789012:asg-hooks"
```

### 3.4 ã‚¦ã‚©ãƒ¼ãƒ ãƒ—ãƒ¼ãƒ«

```
ã€ã‚¦ã‚©ãƒ¼ãƒ ãƒ—ãƒ¼ãƒ«ã®ä»•çµ„ã¿ã€‘

Cold Pool        Warm Pool         ASG (InService)
(AMIã‹ã‚‰èµ·å‹•)    (åœæ­¢/å®Ÿè¡Œä¸­)     (ã‚¢ã‚¯ãƒ†ã‚£ãƒ–)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AMI     â”‚    â”‚Instance â”‚       â”‚Instance â”‚
â”‚         â”‚    â”‚(Stopped)â”‚       â”‚(Running)â”‚
â”‚         â”‚    â”‚         â”‚       â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
               â”‚Instance â”‚       â”‚Instance â”‚
               â”‚(Stopped)â”‚       â”‚(Running)â”‚
               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
           ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆæ™‚
           åœæ­¢â†’èµ·å‹•ï¼ˆé«˜é€Ÿï¼‰
                    â”‚
                    â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚Instance â”‚
               â”‚(Running)â”‚  â† èµ·å‹•æ¸ˆã¿ãªã®ã§é«˜é€Ÿ
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```bash
# ã‚¦ã‚©ãƒ¼ãƒ ãƒ—ãƒ¼ãƒ«ã®è¨­å®š
aws autoscaling put-warm-pool \
  --auto-scaling-group-name web-asg \
  --pool-state Stopped \
  --min-size 2 \
  --max-group-prepared-capacity 4
```

---

## 4. Elastic Load Balancing

### 4.1 ELBã®ç¨®é¡

| ç¨®é¡ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ |
|------|---------|-------------|
| **ALB** | L7 (HTTP/HTTPS) | Webã‚¢ãƒ—ãƒªã€APIã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ |
| **NLB** | L4 (TCP/UDP) | é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€å›ºå®šIPã€TCP |
| **GWLB** | L3 | ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ |
| **CLB** | L4/L7 | ãƒ¬ã‚¬ã‚·ãƒ¼ï¼ˆéæ¨å¥¨ï¼‰ |

### 4.2 ALB vs NLBæ¯”è¼ƒ

| é …ç›® | ALB | NLB |
|------|-----|-----|
| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | 7 (HTTP/HTTPS) | 4 (TCP/UDP/TLS) |
| ãƒ‘ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | ã‚ã‚Š | ãªã— |
| ãƒ›ã‚¹ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | ã‚ã‚Š | ãªã— |
| WebSocket | å¯¾å¿œ | å¯¾å¿œ |
| å›ºå®šIP | ãªã—ï¼ˆDNSåï¼‰ | ã‚ã‚Šï¼ˆElastic IPï¼‰ |
| ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· | é€šå¸¸ | è¶…ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· |
| SSLçµ‚ç«¯ | ALBã§çµ‚ç«¯ | NLBã§ã‚‚TLSçµ‚ç«¯å¯èƒ½ |
| ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | HTTP/HTTPS | TCP/HTTP/HTTPS |
| ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ | ã‚ã‚Š | ãªã—ï¼ˆã‚½ãƒ¼ã‚¹IPã§ä»£æ›¿ï¼‰ |
| Lambdaçµ±åˆ | ã‚ã‚Š | ãªã— |

---

## 5. ALBè©³ç´°

### 5.1 ALBã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ã€ALB ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€‘

Client
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Load Balancer                 â”‚
â”‚                                                              â”‚
â”‚  Listener (port 443 HTTPS)                                  â”‚
â”‚  â”œâ”€ Rule 1: Host = api.example.com                         â”‚
â”‚  â”‚          â†’ Target Group: api-tg                          â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€ Rule 2: Path = /images/*                               â”‚
â”‚  â”‚          â†’ Target Group: images-tg                       â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€ Rule 3: Header = X-Custom = "premium"                  â”‚
â”‚  â”‚          â†’ Target Group: premium-tg                      â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€ Default Rule:                                           â”‚
â”‚           â†’ Target Group: default-tg                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Target Groups                             â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚ api-tg   â”‚  â”‚images-tg â”‚  â”‚default-tgâ”‚           â”‚ â”‚
â”‚  â”‚  â”‚ EC2      â”‚  â”‚ Lambda   â”‚  â”‚ EC2/ECS  â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«

```bash
# ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
aws elbv2 create-rule \
  --listener-arn LISTENER_ARN \
  --conditions '[
    {"Field": "path-pattern", "Values": ["/api/*"]}
  ]' \
  --actions '[
    {"Type": "forward", "TargetGroupArn": "API_TG_ARN"}
  ]' \
  --priority 10

# ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
aws elbv2 create-rule \
  --listener-arn LISTENER_ARN \
  --conditions '[
    {"Field": "host-header", "Values": ["api.example.com"]}
  ]' \
  --actions '[
    {"Type": "forward", "TargetGroupArn": "API_TG_ARN"}
  ]' \
  --priority 20

# åŠ é‡ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆBlue/Green, ã‚«ãƒŠãƒªã‚¢ï¼‰
aws elbv2 create-rule \
  --listener-arn LISTENER_ARN \
  --conditions '[
    {"Field": "path-pattern", "Values": ["/*"]}
  ]' \
  --actions '[
    {
      "Type": "forward",
      "ForwardConfig": {
        "TargetGroups": [
          {"TargetGroupArn": "BLUE_TG_ARN", "Weight": 90},
          {"TargetGroupArn": "GREEN_TG_ARN", "Weight": 10}
        ]
      }
    }
  ]' \
  --priority 30
```

### 5.3 ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³

```bash
# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š
aws elbv2 modify-target-group-attributes \
  --target-group-arn TG_ARN \
  --attributes \
    Key=stickiness.enabled,Value=true \
    Key=stickiness.type,Value=lb_cookie \
    Key=stickiness.lb_cookie.duration_seconds,Value=86400
```

### 5.4 Connection Draining

```bash
# ç™»éŒ²è§£é™¤ã®é…å»¶ï¼ˆConnection Drainingï¼‰
aws elbv2 modify-target-group-attributes \
  --target-group-arn TG_ARN \
  --attributes \
    Key=deregistration_delay.timeout_seconds,Value=300
```

---

## 6. NLB / GWLB

### 6.1 NLBã®ç‰¹å¾´

```
ã€NLB ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‘

Client (å›ºå®šIPçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½)
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Network Load Balancer                     â”‚
â”‚                                                      â”‚
â”‚  AZ-a: Elastic IP 1        AZ-c: Elastic IP 2      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ENI (é™çš„IP)    â”‚      â”‚ ENI (é™çš„IP)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                        â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                        â”‚                            â”‚
â”‚  TCP Listener :443     â”‚                            â”‚
â”‚                        â–¼                            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚              â”‚  Target Group   â”‚                   â”‚
â”‚              â”‚  (IP/Instance)  â”‚                   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹å¾´:
  ãƒ»å›ºå®šIP / Elastic IP å¯¾å¿œ
  ãƒ»è¶…ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
  ãƒ»æ¯ç§’æ•°ç™¾ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†å¯èƒ½
  ãƒ»PrivateLink (VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹) å¯¾å¿œ
```

### 6.2 GWLBï¼ˆGateway Load Balancerï¼‰

```
ã€GWLB ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‘

                    Internet
                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Internet GW   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    GWLB        â”‚
              â”‚  Endpoint      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ GENEVEãƒˆãƒ³ãƒãƒ«
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Gateway Load  â”‚
              â”‚  Balancer      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Security        â”‚
              â”‚ Appliance       â”‚  â† ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã€IDS/IPS
              â”‚ (Target Group)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ASG + ELBé€£æº

### 7.1 é€£æºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ã€ASG + ALB é€£æºã€‘

                    Internet
                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚       ALB       â”‚
              â”‚  (HTTPS:443)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Target Group   â”‚
              â”‚                 â”‚
              â”‚  â”Œâ”€ ASG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  â”‚                                 â”‚
              â”‚  â”‚  AZ-a           AZ-c            â”‚
              â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
              â”‚  â”‚  â”‚ inst-1 â”‚   â”‚ inst-3 â”‚       â”‚
              â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
              â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
              â”‚  â”‚  â”‚ inst-2 â”‚                     â”‚
              â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
              â”‚  â”‚                                 â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯:
  â”œâ”€ EC2ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹çŠ¶æ…‹
  â””â”€ ELBãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯: ã‚¢ãƒ—ãƒªãƒ¬ãƒ™ãƒ«ï¼ˆHTTP 200ï¼‰
```

### 7.2 ASGã¨ELBã®é€£æºè¨­å®š

```bash
# ASGã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’é–¢é€£ä»˜ã‘
aws autoscaling attach-load-balancer-target-groups \
  --auto-scaling-group-name web-asg \
  --target-group-arns "arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/web-tg/1234567890"

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’ELBã«å¤‰æ›´
aws autoscaling update-auto-scaling-group \
  --auto-scaling-group-name web-asg \
  --health-check-type ELB \
  --health-check-grace-period 300
```

### 7.3 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥

```bash
# ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆãƒ­ãƒ¼ãƒªãƒ³ã‚°æ›´æ–°ï¼‰
aws autoscaling start-instance-refresh \
  --auto-scaling-group-name web-asg \
  --preferences '{
    "MinHealthyPercentage": 90,
    "InstanceWarmup": 300,
    "MaxHealthyPercentage": 110
  }' \
  --desired-configuration '{
    "LaunchTemplate": {
      "LaunchTemplateName": "web-server-template",
      "Version": "$Latest"
    }
  }'

# ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥çŠ¶æ³ç¢ºèª
aws autoscaling describe-instance-refreshes \
  --auto-scaling-group-name web-asg
```

---

## 8. ãƒãƒ³ã‚ºã‚ªãƒ³æ¼”ç¿’

### 8.1 æ¼”ç¿’1: èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ASG

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆVPCæƒ…å ±å–å¾—
VPC_ID=$(aws ec2 describe-vpcs --filters "Name=isDefault,Values=true" --query "Vpcs[0].VpcId" --output text)
SUBNETS=$(aws ec2 describe-subnets --filters "Name=vpc-id,Values=${VPC_ID}" --query "Subnets[*].SubnetId" --output text | tr '\t' ',')
SG_ID=$(aws ec2 describe-security-groups --filters "Name=vpc-id,Values=${VPC_ID}" "Name=group-name,Values=default" --query "SecurityGroups[0].GroupId" --output text)

# èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¢ºèªï¼ˆä¸€è¦§è¡¨ç¤ºï¼‰
aws ec2 describe-launch-templates \
  --query "LaunchTemplates[*].{Name:LaunchTemplateName,Version:LatestVersionNumber}" \
  --output table
```

### 8.2 æ¼”ç¿’2: ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼

```bash
# ASGä¸€è¦§ç¢ºèª
aws autoscaling describe-auto-scaling-groups \
  --query "AutoScalingGroups[*].{Name:AutoScalingGroupName,Min:MinSize,Max:MaxSize,Desired:DesiredCapacity}" \
  --output table

# ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®ç¢ºèª
aws autoscaling describe-scaling-activities \
  --auto-scaling-group-name web-asg \
  --max-items 5
```

### 8.3 æ¼”ç¿’3: ELBç¢ºèª

```bash
# ALBä¸€è¦§
aws elbv2 describe-load-balancers \
  --query "LoadBalancers[*].{Name:LoadBalancerName,Type:Type,State:State.Code,DNS:DNSName}" \
  --output table

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§
aws elbv2 describe-target-groups \
  --query "TargetGroups[*].{Name:TargetGroupName,Protocol:Protocol,Port:Port,HealthCheck:HealthCheckPath}" \
  --output table

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®çŠ¶æ…‹ç¢ºèª
# aws elbv2 describe-target-health --target-group-arn TG_ARN
```

---

## 9. DOPè©¦é¨“å¯¾ç­–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Auto ScalingåŸºæœ¬

- [ ] ASGã®Min/Desired/Maxã®é–¢ä¿‚ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] èµ·å‹•ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨èµ·å‹•è¨­å®šã®é•ã„ã‚’çŸ¥ã£ã¦ã„ã‚‹
- [ ] 5ã¤ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ã‚’ä½¿ã„åˆ†ã‘ã§ãã‚‹

<details>
<summary>ğŸ“ æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**Min/Desired/Max**:
- Min: æœ€å°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ï¼ˆã“ã‚Œä»¥ä¸‹ã«ãªã‚‰ãªã„ï¼‰
- Desired: å¸Œæœ›ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ï¼ˆASGãŒç¶­æŒã™ã‚‹æ•°ï¼‰
- Max: æœ€å¤§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ï¼ˆã“ã‚Œä»¥ä¸Šå¢—ãˆãªã„ï¼‰
- é–¢ä¿‚: Min â‰¤ Desired â‰¤ Max

**ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ã®ä½¿ã„åˆ†ã‘**:
| ãƒãƒªã‚·ãƒ¼ | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ |
|---------|-------------|
| Target Tracking | ä¸€å®šã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹å€¤ã‚’ç¶­æŒï¼ˆæœ€æ¨å¥¨ï¼‰ |
| Step Scaling | è² è·ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸæ®µéšçš„ã‚¹ã‚±ãƒ¼ãƒ« |
| Simple Scaling | ãƒ¬ã‚¬ã‚·ãƒ¼ï¼ˆéæ¨å¥¨ï¼‰ |
| Scheduled | äºˆæ¸¬å¯èƒ½ãªè² è·ãƒ‘ã‚¿ãƒ¼ãƒ³ |
| Predictive | MLäºˆæ¸¬ã«ã‚ˆã‚‹äº‹å‰ã‚¹ã‚±ãƒ¼ãƒ« |
</details>

### é«˜åº¦ãªæ©Ÿèƒ½

- [ ] ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ã®ç”¨é€”ã¨è¨­å®šã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] ã‚¦ã‚©ãƒ¼ãƒ ãƒ—ãƒ¼ãƒ«ã®ä»•çµ„ã¿ã‚’èª¬æ˜ã§ãã‚‹
- [ ] ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã®è¨­å®šãŒã§ãã‚‹
- [ ] Mixed Instances Policyã‚’ç†è§£ã—ã¦ã„ã‚‹

<details>
<summary>ğŸ“ æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯**:
- èµ·å‹•æ™‚(Launching): è¨­å®šé©ç”¨ã€ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¾…ã¡
- çµ‚äº†æ™‚(Terminating): ãƒ­ã‚°é€€é¿ã€æ¥ç¶šãƒ‰ãƒ¬ã‚¤ãƒ³
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¾Œã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: CONTINUE or ABANDON

**ã‚¦ã‚©ãƒ¼ãƒ ãƒ—ãƒ¼ãƒ«**:
- äº‹å‰ã«åœæ­¢çŠ¶æ…‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å¾…æ©Ÿ
- ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆæ™‚ã«èµ·å‹•ï¼ˆAMIã‹ã‚‰ã®èµ·å‹•ã‚ˆã‚Šé«˜é€Ÿï¼‰
- ã‚³ã‚¹ãƒˆ: åœæ­¢ä¸­ã¯EBSã®ã¿èª²é‡‘

**ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥**:
- ASGå†…ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ­ãƒ¼ãƒªãƒ³ã‚°æ›´æ–°
- MinHealthyPercentage: æ­£å¸¸ã‚’ç¶­æŒã™ã‚‹å‰²åˆ
- InstanceWarmup: æ–°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å®‰å®šåŒ–å¾…ã¡æ™‚é–“

**Mixed Instances Policy**:
- è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã®æ··åœ¨ï¼ˆä¾‹: t3.medium + t3a.mediumï¼‰
- ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ + ã‚¹ãƒãƒƒãƒˆã®æ··åœ¨
- å®¹é‡æœ€é©åŒ–æˆ¦ç•¥ã§ã‚¹ãƒãƒƒãƒˆä¸­æ–­ãƒªã‚¹ã‚¯ä½æ¸›
</details>

### ELB

- [ ] ALBã€NLBã€GWLBã®ä½¿ã„åˆ†ã‘ãŒã§ãã‚‹
- [ ] ALBã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ï¼ˆãƒ‘ã‚¹/ãƒ›ã‚¹ãƒˆ/ãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ã‚’è¨­å®šã§ãã‚‹
- [ ] Connection Drainingã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯Grace Periodã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] åŠ é‡ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã§ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ãŒã§ãã‚‹

<details>
<summary>ğŸ“ æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã‚‹</summary>

**ELBã®ä½¿ã„åˆ†ã‘**:
- ALB: HTTP/HTTPSã€ãƒ‘ã‚¹/ãƒ›ã‚¹ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€Lambdaçµ±åˆ
- NLB: TCP/UDPã€å›ºå®šIPã€è¶…ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã€PrivateLink
- GWLB: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã€ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯æ¤œæŸ»

**Connection Draining (Deregistration Delay)**:
- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç™»éŒ²è§£é™¤æ™‚ã«æ—¢å­˜æ¥ç¶šã‚’å®Œäº†ã•ã›ã‚‹
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 300ç§’
- è¨­å®š: 0ã€œ3600ç§’

**ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯Grace Period**:
- æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çŒ¶äºˆæ™‚é–“
- èµ·å‹•ç›´å¾Œã®false positiveã‚’é˜²æ­¢
- æ¨å¥¨: ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚é–“ + ãƒãƒƒãƒ•ã‚¡

**åŠ é‡ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—**:
```
Blue TG: 90% â†’ æ—¢å­˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³
Green TG: 10% â†’ æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³
â†’ æ®µéšçš„ã«Greenã®æ¯”é‡ã‚’å¢—åŠ ï¼ˆã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
```
</details>

---

**ä½œæˆæ—¥**: 2026-02-04
**æœ€çµ‚æ›´æ–°**: 2026-02-04
**æ¤œè¨¼ç’°å¢ƒ**: AWS ap-northeast-1 ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
